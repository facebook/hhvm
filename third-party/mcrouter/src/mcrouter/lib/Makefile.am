# Copyright (c) Facebook, Inc. and its affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.

SUBDIRS = carbon network/gen . config fbi network/test test

noinst_LIBRARIES = libmcrouter.a

libmcrouter_a_SOURCES = \
  AuxiliaryCPUThreadPool.h \
  AuxiliaryCPUThreadPool.cpp \
  AuxiliaryIOThreadPool.h \
  AuxiliaryIOThreadPool.cpp \
  CacheClientStats.h \
  Ch3HashFunc.h \
  Clocks.cpp \
  Clocks.h \
  Compression.cpp \
  Compression.h \
  CompressionCodecManager.cpp \
  CompressionCodecManager.h \
  Crc32HashFunc.h \
  FailoverErrorsSettingsBase.cpp \
  FailoverErrorsSettingsBase.h \
  FailoverErrorsSettings.h \
  HashUtil.h \
  IOBufUtil.cpp \
  IOBufUtil.h \
  IovecCursor-inl.h \
  IovecCursor.cpp \
  IovecCursor.h \
  Lz4CompressionCodec.cpp \
  Lz4CompressionCodec.h \
  Lz4Immutable.cpp \
  Lz4Immutable.h \
  Lz4ImmutableCompressionCodec.cpp \
  Lz4ImmutableCompressionCodec.h \
  MessageQueue.cpp \
  MessageQueue.h \
  McResUtil.h \
  Operation.h \
  PoolContext.h \
  Ref.h \
  RendezvousHashFunc.cpp \
  RendezvousHashFunc.h \
  RendezvousHashHelper.cpp \
  RendezvousHashHelper.h \
  Reply.h \
  RouteHandleTraverser.h \
  SelectionRouteFactory.h \
  StatsReply.cpp \
  StatsReply.h \
  WeightedCh3HashFunc.cpp \
  WeightedCh3HashFunc.h \
  WeightedCh4HashFunc.cpp \
  WeightedCh4HashFunc.h \
  WeightedChHashFuncBase.cpp \
  WeightedChHashFuncBase.h \
  WeightedRendezvousHashFunc.cpp \
  WeightedRendezvousHashFunc.h \
  ZstdCompressionCodec.cpp \
  ZstdCompressionCodec.h \
  carbon/Fields.h \
  carbon/FailoverUtil.h \
  carbon/CarbonQueueAppender.cpp \
  carbon/CarbonQueueAppender.h \
  carbon/CarbonProtocolCommon.h \
  carbon/CarbonProtocolReader.cpp \
  carbon/CarbonProtocolReader.h \
  carbon/CarbonProtocolWriter.h \
  carbon/CommonSerializationTraits.h \
  carbon/ExternalCarbonConnectionStats.h \
  carbon/Keys-inl.h \
  carbon/Keys.h \
  carbon/NoopAdditionalLogger.h \
  carbon/NoopExternalConnectionLogger.h \
  carbon/ReplyCommon.h \
  carbon/RequestCommon.h \
  carbon/RequestReplyUtil.h \
  carbon/Result.cpp \
  carbon/Result.h \
  carbon/RoutingGroups.h \
  carbon/SerializationTraits.h \
  carbon/Stats.h \
  carbon/TypeList-inl.h \
  carbon/TypeList.h \
  carbon/Util.h \
  carbon/Variant.h \
  carbon/gen-cpp2/carbon_result_types.cpp \
  carbon/gen-cpp2/carbon_result_types.h \
  carbon/gen-cpp2/carbon_result_types.tcc \
  carbon/gen-cpp2/carbon_result_data.cpp \
  carbon/gen-cpp2/carbon_result_data.h \
  carbon/gen-cpp2/carbon_types.cpp \
  carbon/gen-cpp2/carbon_types.h \
  carbon/gen-cpp2/carbon_types.tcc \
  carbon/gen-cpp2/carbon_data.cpp \
  carbon/gen-cpp2/carbon_data.h \
  config/ConfigPreprocessor.cpp \
  config/ConfigPreprocessor.h \
  config/ImportResolverIf.h \
  config/RendezvousHash.cpp \
  config/RendezvousHash.h \
  config/RouteHandleBuilder.h \
  config/RouteHandleFactory-inl.h \
  config/RouteHandleFactory.h \
  config/RouteHandleProviderIf.h \
  debug/ConnectionFifo.cpp \
  debug/ConnectionFifo.h \
  debug/ConnectionFifoProtocol.cpp \
  debug/ConnectionFifoProtocol.h \
  debug/Fifo.cpp \
  debug/Fifo.h \
  debug/FifoManager.cpp \
  debug/FifoManager.h \
  fbi/counting_sem.cpp \
  fbi/counting_sem.h \
  fbi/cpp/FuncGenerator.h \
  fbi/cpp/LogFailure.cpp \
  fbi/cpp/LogFailure.h \
  fbi/cpp/Trie-inl.h \
  fbi/cpp/Trie.h \
  fbi/cpp/TypeList-inl.h \
  fbi/cpp/TypeList.h \
  fbi/cpp/globals.cpp \
  fbi/cpp/globals.h \
  fbi/cpp/LowerBoundPrefixMap.cpp \
  fbi/cpp/LowerBoundPrefixMap.h \
  fbi/cpp/ParsingUtil.cpp \
  fbi/cpp/ParsingUtil.h \
  fbi/cpp/util.cpp \
  fbi/cpp/util.h \
  fbi/decls.h \
  fbi/WeightedFurcHash.cpp \
  fbi/WeightedFurcHash.h \
  fbi/hash.c \
  fbi/hash.h \
  fbi/network.c \
  fbi/network.h \
  fbi/queue.h \
  fbi/time.h \
  fbi/util.h \
  mc/msg.cpp \
  mc/msg.h \
  mc/protocol.h \
  network/AccessPoint.cpp \
  network/AccessPoint.h \
  network/AsciiSerialized-inl.h \
  network/AsciiSerialized.cpp \
  network/AsciiSerialized.h \
  network/AsyncMcClient-inl.h \
  network/AsyncMcClient.h \
  network/AsyncMcClientImpl-inl.h \
  network/AsyncMcClientImpl.cpp \
  network/AsyncMcClientImpl.h \
  network/AsyncMcServer.cpp \
  network/AsyncMcServer.h \
  network/AsyncMcServerWorker.cpp \
  network/AsyncMcServerWorker.h \
  network/AsyncMcServerWorkerOptions.h \
  network/AsyncTlsToPlaintextSocket.cpp \
  network/AsyncTlsToPlaintextSocket.h \
  network/CarbonMessageDispatcher.h \
  network/CarbonMessageList.h \
  network/CarbonMessageTraits.h \
  network/CarbonRequestHandler.h \
  network/CaretHeader.h \
  network/CaretProtocol.cpp \
  network/CaretProtocol.h \
  network/CaretSerializedMessage-inl.h \
  network/CaretSerializedMessage.h \
  network/ClientMcParser-inl.h \
  network/ClientMcParser.h \
  network/ConnectionDownReason.h \
  network/ConnectionOptions.h \
  network/ConnectionTracker.cpp \
  network/ConnectionTracker.h \
  network/CpuController.cpp \
  network/CpuController.h \
  network/FailureDomains.cpp \
  network/FailureDomains.h \
  network/gen/CommonMessages-inl.h \
  network/gen/CommonMessages.cpp \
  network/gen/CommonMessagesThrift.cpp \
  network/gen/CommonMessages.h \
  network/gen/MemcacheMessages-inl.h \
  network/gen/MemcacheMessages.cpp \
  network/gen/MemcacheMessagesThrift.cpp \
  network/gen/MemcacheMessages.h \
  network/gen/gen-cpp2/Common_types.cpp \
  network/gen/gen-cpp2/Common_types.h \
  network/gen/gen-cpp2/Common_types.tcc \
  network/gen/gen-cpp2/Common_data.cpp \
  network/gen/gen-cpp2/Common_data.h \
  network/gen/gen-cpp2/MemcacheAsyncClient.cpp \
  network/gen/gen-cpp2/MemcacheAsyncClient.h \
  network/gen/gen-cpp2/MemcacheService_constants.cpp \
  network/gen/gen-cpp2/MemcacheService_constants.h \
  network/gen/gen-cpp2/MemcacheService_types.cpp \
  network/gen/gen-cpp2/MemcacheService_types.h \
  network/gen/gen-cpp2/MemcacheService_types.tcc \
  network/gen/gen-cpp2/MemcacheService_data.cpp \
  network/gen/gen-cpp2/MemcacheService_data.h \
  network/gen/gen-cpp2/Memcache_types.cpp \
  network/gen/gen-cpp2/Memcache_types.h \
  network/gen/gen-cpp2/Memcache_types.tcc \
  network/gen/gen-cpp2/Memcache_data.cpp \
  network/gen/gen-cpp2/Memcache_data.h \
  network/FizzContextProvider.cpp \
  network/FizzContextProvider.h \
  network/McAsciiParser-gen.cpp \
  network/McAsciiParser-inl.h \
  network/McAsciiParser.cpp \
  network/McAsciiParser.h \
  network/McClientRequestContext-inl.h \
  network/McClientRequestContext.cpp \
  network/McClientRequestContext.h \
  network/McParser.cpp \
  network/McParser.h \
  network/McSerializedRequest.cpp \
  network/McSerializedRequest.h \
  network/McServerRequestContext-inl.h \
  network/McServerRequestContext.cpp \
  network/McServerRequestContext.h \
  network/McServerSession.cpp \
  network/McServerSession.h \
  network/McServerThriftRequestContext.cpp \
  network/McServerThriftRequestContext.h \
  network/McSSLUtil.cpp \
  network/McSSLUtil.h \
  network/MessageHelpers.h \
  network/MultiOpParent.cpp \
  network/MultiOpParent.h \
  network/Qos.cpp \
  network/Qos.h \
  network/SecurityOptions.cpp \
  network/SecurityOptions.h \
  network/ServerLoad.cpp \
  network/ServerLoad.h \
  network/ServerMcParser-inl.h \
  network/ServerMcParser.h \
  network/SocketConnector.cpp \
  network/SocketConnector.h \
  network/SocketUtil.cpp \
  network/SocketUtil.h \
  network/ThreadLocalSSLContextProvider.cpp \
  network/ThreadLocalSSLContextProvider.h \
  network/ThriftTransport-inl.h \
  network/ThriftTransport.cpp \
  network/ThriftTransport.h \
  network/Transport.h \
  network/UniqueIntrusiveList.h \
  network/WriteBuffer.cpp \
  network/WriteBuffer.h \
  routes/AllAsyncRoute.h \
  routes/AllFastestRoute.h \
  routes/AllInitialRoute.h \
  routes/AllMajorityRoute.h \
  routes/AllSyncRoute.h \
  routes/CarbonLookasideRoute.h \
  routes/LoadBalancerRoute.h \
  routes/LoggingRoute.h \
  routes/MigrateRoute.h \
  routes/NullRoute.h \
  routes/RandomRoute.h \
  routes/SelectionRoute.h

libmcrouter_a_CPPFLAGS = -I$(top_srcdir)/..
libmcrouter_a_CFLAGS = -I$(top_srcdir)/..

# build gtest on check
check_LTLIBRARIES = libtestmain.la
check_PROGRAMS =

libtestmain_la_CPPFLAGS = $(GTEST_CFLAGS)
libtestmain_la_SOURCES = TestMain.cpp
libtestmain_la_LIBADD = -lfolly $(GTEST_LIBS)
