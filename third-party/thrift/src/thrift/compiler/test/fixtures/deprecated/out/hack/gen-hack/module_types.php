<?hh
/**
 * Autogenerated by Thrift
 *
 * DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
 *  @generated
 */

namespace test\fixtures\deprecated;

/**
 * Example struct demonstrating @thrift.Deprecated annotation on fields.
 *
 * Original thrift struct:-
 * User
 */
<<\ThriftTypeInfo(shape('uri' => 'facebook.com/thrift/test/User'))>>
class User implements \IThriftSyncStruct, \IThriftStructMetadata {
  use \ThriftSerializationTrait;

  const \ThriftStructTypes::TSpec SPEC = dict[
    1 => shape(
      'var' => 'id',
      'type' => \TType::I64,
    ),
    2 => shape(
      'var' => 'name',
      'type' => \TType::STRING,
    ),
    3 => shape(
      'var' => 'full_name',
      'type' => \TType::STRING,
    ),
    4 => shape(
      'var' => 'email',
      'type' => \TType::STRING,
    ),
    5 => shape(
      'var' => 'email_address',
      'type' => \TType::STRING,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'id' => 1,
    'name' => 2,
    'full_name' => 3,
    'email' => 4,
    'email_address' => 5,
  ];

  const type TConstructorShape = shape(
    ?'id' => ?int,
    ?'name' => ?string,
    ?'full_name' => ?string,
    ?'email' => ?string,
    ?'email_address' => ?string,
  );

  const int STRUCTURAL_ID = 1485702078879754858;
  /**
   * Original thrift field:-
   * 1: i64 id
   */
  public int $id;
  /**
   * @deprecated Use 'full_name' instead
   * 
   * Original thrift field:-
   * 2: string name
   */
  <<__Deprecated("Use 'full_name' instead")>>
  public string $name;
  /**
   * Original thrift field:-
   * 3: string full_name
   */
  public string $full_name;
  /**
   * @deprecated This field is no longer used
   * 
   * Original thrift field:-
   * 4: string email
   */
  <<__Deprecated("This field is no longer used")>>
  public ?string $email;
  /**
   * Original thrift field:-
   * 5: string email_address
   */
  public ?string $email_address;

  public function __construct(?int $id = null, ?string $name = null, ?string $full_name = null, ?string $email = null, ?string $email_address = null)[] {
    $this->id = $id ?? 0;
    $this->name = $name ?? '';
    $this->full_name = $full_name ?? '';
    $this->email = $email;
    $this->email_address = $email_address;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'id'),
      Shapes::idx($shape, 'name'),
      Shapes::idx($shape, 'full_name'),
      Shapes::idx($shape, 'email'),
      Shapes::idx($shape, 'email_address'),
    );
  }

  public function getName()[]: string {
    return 'User';
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.User",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I64_TYPE,
                )
              ),
              "name" => "id",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "name",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "full_name",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 4,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "email",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "email_address",
              "is_optional" => true,
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
        'name' => shape(
          'field' => dict[
            '\facebook\thrift\annotation\Deprecated' => \facebook\thrift\annotation\Deprecated::fromShape(
              shape(
                "message" => "Use 'full_name' instead",
              )
            ),
          ],
          'type' => dict[],
        ),
        'email' => shape(
          'field' => dict[
            '\facebook\thrift\annotation\Deprecated' => \facebook\thrift\annotation\Deprecated::fromShape(
              shape(
                "message" => "This field is no longer used",
              )
            ),
          ],
          'type' => dict[],
        ),
      ],
    );
  }

  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'id') !== null) {
      $this->id = HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['id']);
    }
    if (idx($parsed, 'name') !== null) {
      $this->name = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['name']);
    }
    if (idx($parsed, 'full_name') !== null) {
      $this->full_name = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['full_name']);
    }
    if (idx($parsed, 'email') !== null) {
      $this->email = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['email']);
    }
    if (idx($parsed, 'email_address') !== null) {
      $this->email_address = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['email_address']);
    }
  }

}

enum ExampleUnionEnum: int {
  _EMPTY_ = 0;
  stringValue = 1;
  intValue = 2;
  doubleValue = 3;
}

/**
 * Example union with deprecated field.
 *
 * Original thrift union:-
 * ExampleUnion
 */
<<\ThriftTypeInfo(shape('uri' => 'facebook.com/thrift/test/ExampleUnion'))>>
class ExampleUnion implements \IThriftSyncStruct, \IThriftStructMetadata, \IThriftUnion<\test\fixtures\deprecated\ExampleUnionEnum> {
  use \ThriftUnionSerializationTrait;

  const \ThriftStructTypes::TSpec SPEC = dict[
    1 => shape(
      'var' => 'stringValue',
      'union' => true,
      'type' => \TType::STRING,
    ),
    2 => shape(
      'var' => 'intValue',
      'union' => true,
      'type' => \TType::I32,
    ),
    3 => shape(
      'var' => 'doubleValue',
      'union' => true,
      'type' => \TType::DOUBLE,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'stringValue' => 1,
    'intValue' => 2,
    'doubleValue' => 3,
  ];

  const type TConstructorShape = shape(
    ?'stringValue' => ?string,
    ?'intValue' => ?int,
    ?'doubleValue' => ?float,
  );

  const int STRUCTURAL_ID = 8671071951937553392;
  /**
   * Original thrift field:-
   * 1: string stringValue
   */
  public ?string $stringValue;
  /**
   * Original thrift field:-
   * 2: i32 intValue
   */
  <<__Deprecated("Use stringValue instead")>>
  public ?int $intValue;
  /**
   * Original thrift field:-
   * 3: double doubleValue
   */
  public ?float $doubleValue;
  protected \test\fixtures\deprecated\ExampleUnionEnum $_type = \test\fixtures\deprecated\ExampleUnionEnum::_EMPTY_;

  public function __construct(?string $stringValue = null, ?int $intValue = null, ?float $doubleValue = null)[] {
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::_EMPTY_;
    if ($stringValue !== null) {
      $this->stringValue = $stringValue;
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::stringValue;
    }
    if ($intValue !== null) {
      $this->intValue = $intValue;
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::intValue;
    }
    if ($doubleValue !== null) {
      $this->doubleValue = $doubleValue;
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::doubleValue;
    }
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'stringValue'),
      Shapes::idx($shape, 'intValue'),
      Shapes::idx($shape, 'doubleValue'),
    );
  }

  public function getName()[]: string {
    return 'ExampleUnion';
  }

  public function getType()[]: \test\fixtures\deprecated\ExampleUnionEnum {
    return $this->_type;
  }

  public function reset()[write_props]: void {
    switch ($this->_type) {
      case \test\fixtures\deprecated\ExampleUnionEnum::stringValue:
        $this->stringValue = null;
        break;
      case \test\fixtures\deprecated\ExampleUnionEnum::intValue:
        $this->intValue = null;
        break;
      case \test\fixtures\deprecated\ExampleUnionEnum::doubleValue:
        $this->doubleValue = null;
        break;
      case \test\fixtures\deprecated\ExampleUnionEnum::_EMPTY_:
        break;
    }
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::_EMPTY_;
  }

  public function set_stringValue(string $stringValue)[write_props]: this {
    $this->reset();
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::stringValue;
    $this->stringValue = $stringValue;
    return $this;
  }

  public function get_stringValue()[]: ?string {
    $this->logIncorrectFieldAccessed(
      $this->_type,
      \test\fixtures\deprecated\ExampleUnionEnum::stringValue,
    );
    return $this->stringValue;
  }

  public function getx_stringValue()[]: string {
    invariant(
      $this->_type === \test\fixtures\deprecated\ExampleUnionEnum::stringValue,
      'get_stringValue called on an instance of ExampleUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->stringValue as nonnull;
  }

  public function set_intValue(int $intValue)[write_props]: this {
    $this->reset();
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::intValue;
    $this->intValue = $intValue;
    return $this;
  }

  public function get_intValue()[]: ?int {
    $this->logIncorrectFieldAccessed(
      $this->_type,
      \test\fixtures\deprecated\ExampleUnionEnum::intValue,
    );
    return $this->intValue;
  }

  public function getx_intValue()[]: int {
    invariant(
      $this->_type === \test\fixtures\deprecated\ExampleUnionEnum::intValue,
      'get_intValue called on an instance of ExampleUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->intValue as nonnull;
  }

  public function set_doubleValue(float $doubleValue)[write_props]: this {
    $this->reset();
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::doubleValue;
    $this->doubleValue = $doubleValue;
    return $this;
  }

  public function get_doubleValue()[]: ?float {
    $this->logIncorrectFieldAccessed(
      $this->_type,
      \test\fixtures\deprecated\ExampleUnionEnum::doubleValue,
    );
    return $this->doubleValue;
  }

  public function getx_doubleValue()[]: float {
    invariant(
      $this->_type === \test\fixtures\deprecated\ExampleUnionEnum::doubleValue,
      'get_doubleValue called on an instance of ExampleUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->doubleValue as nonnull;
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.ExampleUnion",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "stringValue",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                )
              ),
              "name" => "intValue",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_DOUBLE_TYPE,
                )
              ),
              "name" => "doubleValue",
            )
          ),
        ],
        "is_union" => true,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
        'intValue' => shape(
          'field' => dict[
            '\facebook\thrift\annotation\Deprecated' => \facebook\thrift\annotation\Deprecated::fromShape(
              shape(
                "message" => "Use stringValue instead",
              )
            ),
          ],
          'type' => dict[],
        ),
      ],
    );
  }

  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::_EMPTY_;
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'stringValue') !== null) {
      $this->stringValue = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['stringValue']);
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::stringValue;
    }
    if (idx($parsed, 'intValue') !== null) {
      $_tmp0 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['intValue']);
      if ($_tmp0 > 0x7fffffff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->intValue = (int)$_tmp0;
      }
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::intValue;
    }
    if (idx($parsed, 'doubleValue') !== null) {
      $this->doubleValue = HH\FIXME\UNSAFE_CAST<mixed, float>($parsed['doubleValue']);
      $this->_type = \test\fixtures\deprecated\ExampleUnionEnum::doubleValue;
    }
  }

}

