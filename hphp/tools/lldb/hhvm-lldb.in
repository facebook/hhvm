#!/bin/sh

set -e

HHVM_INSTALL_PREFIX="@CMAKE_INSTALL_PREFIX@"
HHVM_INSTALL_LIBDIR="@CMAKE_INSTALL_LIBDIR@"
HHVM_LIB="$HHVM_INSTALL_PREFIX/$HHVM_INSTALL_LIBDIR/hhvm"

if [ -z "$HHVM_BIN" ] ; then
  HHVM_BIN=$HHVM_INSTALL_PREFIX/bin/hhvm
fi

echo "Debugging with hhvm: $HHVM_BIN ..."

lldb=lldb
if ! command -v "$lldb" > /dev/null; then
        echo "$lldb not found! Please install it." >&2
        exit 1
fi

# If $1 is --args, we let the user provide the file/args manually.
# Otherwise, we target the HHVM_BIN.
if [ "$1" = "--args" ]; then
  TARGET_ARGS=""
else
  TARGET_ARGS="$HHVM_BIN"
fi

script_import="command script import \"$HHVM_LIB/lldb/hhvm.py\""

# Use -f for clarity or just pass the variable
exec $lldb --one-line-before-file "$script_import" --file "$TARGET_ARGS" "$@"
