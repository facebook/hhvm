(rule
  (targets build-id build-id.c)
  (deps (universe))
  (action
    (progn
      (write-file generate-build-id.sh "INSTALL_DIR=$PWD FBCODE_DIR=%{env:CMAKE_SOURCE_DIR=xxx} %{env:CMAKE_SOURCE_DIR=yyy}/hphp/tools/generate-build-id.sh IGNORED IGNORED hackc hphp/hack/src")
      (system "chmod +x generate-build-id.sh && ./generate-build-id.sh"))))

(rule
  (targets build-id-opt)
  (action
    (write-file build-id-opt -DHH_BUILD_BANNER=%{read:build-id})))

(rule
  (targets build-timestamp-opt)
  (action
    (with-stdout-to build-timestamp-opt
      (system "echo -DHH_BUILD_TIMESTAMP=$(date +%s)ul"))))
