<?hh
/**
 * Autogenerated by Thrift
 *
 * DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
 *  @generated
 */

namespace fixtures\patch;

/**
 * Original thrift enum:-
 * MyEnum
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyEnum'))>>
enum MyEnum: int {
  MyValue0 = 0;
}

class MyEnum_TEnumStaticMetadata implements \IThriftEnumStaticMetadata {
  public static function getEnumMetadata()[]: \tmeta_ThriftEnum {
    return \tmeta_ThriftEnum::fromShape(
      shape(
        "name" => "module.MyEnum",
        "elements" => dict[
          0 => "MyValue0",
        ],
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TEnumAnnotations {
    return shape(
      'enum' => dict[],
      'constants' => dict[
      ],
    );
  }
}

/**
 * Original thrift struct:-
 * MyData
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyData'))>>
class MyData implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'data1',
      'is_terse' => true,
      'type' => \TType::STRING,
    ),
    2 => shape(
      'var' => 'data2',
      'is_terse' => true,
      'type' => \TType::I32,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'data1' => 1,
    'data2' => 2,
  ];

  const type TConstructorShape = shape(
    ?'data1' => ?string,
    ?'data2' => ?int,
  );

  const type TShape = shape(
    'data1' => string,
    'data2' => int,
    ...
  );
  const int STRUCTURAL_ID = 5497211930825790974;
  /**
   * Original thrift field:-
   * 1: string data1
   */
  public string $data1;
  /**
   * Original thrift field:-
   * 2: i32 data2
   */
  public int $data2;

  public function __construct(?string $data1 = null, ?int $data2 = null)[] {
    $this->data1 = $data1 ?? '';
    $this->data2 = $data2 ?? 0;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'data1'),
      Shapes::idx($shape, 'data2'),
    );
  }

  public function getName()[]: string {
    return 'MyData';
  }

  public function clearTerseFields()[write_props]: void {
    $this->data1 = '';
    $this->data2 = 0;
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyData",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "data1",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                )
              ),
              "name" => "data2",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      $shape['data1'],
      $shape['data2'],
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'data1' => $this->data1,
      'data2' => $this->data2,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'data1') !== null) {
      $this->data1 = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['data1']);
    }
    if (idx($parsed, 'data2') !== null) {
      $_tmp0 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['data2']);
      if ($_tmp0 > 0x7fffffff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->data2 = (int)$_tmp0;
      }
    }
  }

}

enum InnerUnionEnum: int {
  _EMPTY_ = 0;
  innerOption = 1;
}

/**
 * Original thrift struct:-
 * InnerUnion
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/InnerUnion'))>>
class InnerUnion implements \IThriftSyncStruct, \IThriftUnion<\fixtures\patch\InnerUnionEnum>, \IThriftShapishSyncStruct {
  use \ThriftUnionSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'innerOption',
      'union' => true,
      'type' => \TType::STRING,
      'is_binary' => true,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'innerOption' => 1,
  ];

  const type TConstructorShape = shape(
    ?'innerOption' => ?string,
  );

  const type TShape = shape(
    ?'innerOption' => ?string,
    ...
  );
  const int STRUCTURAL_ID = 8244649827300221001;
  /**
   * Original thrift field:-
   * 1: binary innerOption
   */
  public ?string $innerOption;
  protected \fixtures\patch\InnerUnionEnum $_type = \fixtures\patch\InnerUnionEnum::_EMPTY_;

  public function __construct(?string $innerOption = null)[] {
    $this->_type = \fixtures\patch\InnerUnionEnum::_EMPTY_;
    if ($innerOption !== null) {
      $this->innerOption = $innerOption;
      $this->_type = \fixtures\patch\InnerUnionEnum::innerOption;
    }
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'innerOption'),
    );
  }

  public function getName()[]: string {
    return 'InnerUnion';
  }

  public function getType()[]: \fixtures\patch\InnerUnionEnum {
    return $this->_type;
  }

  public function reset()[write_props]: void {
    switch ($this->_type) {
      case \fixtures\patch\InnerUnionEnum::innerOption:
        $this->innerOption = null;
        break;
      case \fixtures\patch\InnerUnionEnum::_EMPTY_:
        break;
    }
    $this->_type = \fixtures\patch\InnerUnionEnum::_EMPTY_;
  }

  public function set_innerOption(string $innerOption)[write_props]: this {
    $this->reset();
    $this->_type = \fixtures\patch\InnerUnionEnum::innerOption;
    $this->innerOption = $innerOption;
    return $this;
  }

  public function get_innerOption()[]: ?string {
    return $this->innerOption;
  }

  public function getx_innerOption()[]: string {
    invariant(
      $this->_type === \fixtures\patch\InnerUnionEnum::innerOption,
      'get_innerOption called on an instance of InnerUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->innerOption as nonnull;
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.InnerUnion",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BINARY_TYPE,
                )
              ),
              "name" => "innerOption",
            )
          ),
        ],
        "is_union" => true,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'innerOption'),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'innerOption' => $this->innerOption,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $this->_type = \fixtures\patch\InnerUnionEnum::_EMPTY_;
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'innerOption') !== null) {
      $this->innerOption = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['innerOption']);
      $this->_type = \fixtures\patch\InnerUnionEnum::innerOption;
    }
  }

}

enum MyUnionEnum: int {
  _EMPTY_ = 0;
  option1 = 1;
  option2 = 2;
  option3 = 3;
}

/**
 * Original thrift struct:-
 * MyUnion
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyUnion'))>>
class MyUnion implements \IThriftSyncStruct, \IThriftUnion<\fixtures\patch\MyUnionEnum>, \IThriftShapishSyncStruct {
  use \ThriftUnionSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'option1',
      'union' => true,
      'type' => \TType::STRING,
    ),
    2 => shape(
      'var' => 'option2',
      'union' => true,
      'type' => \TType::I32,
    ),
    3 => shape(
      'var' => 'option3',
      'union' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnion::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'option1' => 1,
    'option2' => 2,
    'option3' => 3,
  ];

  const type TConstructorShape = shape(
    ?'option1' => ?string,
    ?'option2' => ?int,
    ?'option3' => ?\fixtures\patch\InnerUnion,
  );

  const type TShape = shape(
    ?'option1' => ?string,
    ?'option2' => ?int,
    ?'option3' => ?\fixtures\patch\InnerUnion::TShape,
    ...
  );
  const int STRUCTURAL_ID = 2373941666242479705;
  /**
   * Original thrift field:-
   * 1: string option1
   */
  public ?string $option1;
  /**
   * Original thrift field:-
   * 2: i32 option2
   */
  public ?int $option2;
  /**
   * Original thrift field:-
   * 3: struct module.InnerUnion option3
   */
  public ?\fixtures\patch\InnerUnion $option3;
  protected \fixtures\patch\MyUnionEnum $_type = \fixtures\patch\MyUnionEnum::_EMPTY_;

  public function __construct(?string $option1 = null, ?int $option2 = null, ?\fixtures\patch\InnerUnion $option3 = null)[] {
    $this->_type = \fixtures\patch\MyUnionEnum::_EMPTY_;
    if ($option1 !== null) {
      $this->option1 = $option1;
      $this->_type = \fixtures\patch\MyUnionEnum::option1;
    }
    if ($option2 !== null) {
      $this->option2 = $option2;
      $this->_type = \fixtures\patch\MyUnionEnum::option2;
    }
    if ($option3 !== null) {
      $this->option3 = $option3;
      $this->_type = \fixtures\patch\MyUnionEnum::option3;
    }
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'option1'),
      Shapes::idx($shape, 'option2'),
      Shapes::idx($shape, 'option3'),
    );
  }

  public function getName()[]: string {
    return 'MyUnion';
  }

  public function getType()[]: \fixtures\patch\MyUnionEnum {
    return $this->_type;
  }

  public function reset()[write_props]: void {
    switch ($this->_type) {
      case \fixtures\patch\MyUnionEnum::option1:
        $this->option1 = null;
        break;
      case \fixtures\patch\MyUnionEnum::option2:
        $this->option2 = null;
        break;
      case \fixtures\patch\MyUnionEnum::option3:
        $this->option3 = null;
        break;
      case \fixtures\patch\MyUnionEnum::_EMPTY_:
        break;
    }
    $this->_type = \fixtures\patch\MyUnionEnum::_EMPTY_;
  }

  public function set_option1(string $option1)[write_props]: this {
    $this->reset();
    $this->_type = \fixtures\patch\MyUnionEnum::option1;
    $this->option1 = $option1;
    return $this;
  }

  public function get_option1()[]: ?string {
    return $this->option1;
  }

  public function getx_option1()[]: string {
    invariant(
      $this->_type === \fixtures\patch\MyUnionEnum::option1,
      'get_option1 called on an instance of MyUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->option1 as nonnull;
  }

  public function set_option2(int $option2)[write_props]: this {
    $this->reset();
    $this->_type = \fixtures\patch\MyUnionEnum::option2;
    $this->option2 = $option2;
    return $this;
  }

  public function get_option2()[]: ?int {
    return $this->option2;
  }

  public function getx_option2()[]: int {
    invariant(
      $this->_type === \fixtures\patch\MyUnionEnum::option2,
      'get_option2 called on an instance of MyUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->option2 as nonnull;
  }

  public function set_option3(\fixtures\patch\InnerUnion $option3)[write_props]: this {
    $this->reset();
    $this->_type = \fixtures\patch\MyUnionEnum::option3;
    $this->option3 = $option3;
    return $this;
  }

  public function get_option3()[]: ?\fixtures\patch\InnerUnion {
    return $this->option3;
  }

  public function getx_option3()[]: \fixtures\patch\InnerUnion {
    invariant(
      $this->_type === \fixtures\patch\MyUnionEnum::option3,
      'get_option3 called on an instance of MyUnion whose current type is %s',
      (string)$this->_type,
    );
    return $this->option3 as nonnull;
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyUnion",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "option1",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                )
              ),
              "name" => "option2",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnion",
                    )
                  ),
                )
              ),
              "name" => "option3",
            )
          ),
        ],
        "is_union" => true,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'option1'),
      Shapes::idx($shape, 'option2'),
      Shapes::idx($shape, 'option3') === null ? null : (\fixtures\patch\InnerUnion::__fromShape($shape['option3'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'option1' => $this->option1,
      'option2' => $this->option2,
      'option3' => $this->option3?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $this->_type = \fixtures\patch\MyUnionEnum::_EMPTY_;
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'option1') !== null) {
      $this->option1 = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['option1']);
      $this->_type = \fixtures\patch\MyUnionEnum::option1;
    }
    if (idx($parsed, 'option2') !== null) {
      $_tmp0 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['option2']);
      if ($_tmp0 > 0x7fffffff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->option2 = (int)$_tmp0;
      }
      $this->_type = \fixtures\patch\MyUnionEnum::option2;
    }
    if (idx($parsed, 'option3') !== null) {
      $_tmp1 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnion>($parsed['option3']));
      $_tmp2 = \fixtures\patch\InnerUnion::withDefaultValues();
      $_tmp2->readFromJson($_tmp1);
      $this->option3 = $_tmp2;
      $this->_type = \fixtures\patch\MyUnionEnum::option3;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStruct
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStruct'))>>
class MyStruct implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'boolVal',
      'is_terse' => true,
      'type' => \TType::BOOL,
    ),
    -2 => shape(
      'var' => 'byteVal',
      'is_terse' => true,
      'type' => \TType::BYTE,
    ),
    -3 => shape(
      'var' => 'i16Val',
      'is_terse' => true,
      'type' => \TType::I16,
    ),
    -4 => shape(
      'var' => 'i32Val',
      'is_terse' => true,
      'type' => \TType::I32,
    ),
    -5 => shape(
      'var' => 'i64Val',
      'is_terse' => true,
      'type' => \TType::I64,
    ),
    -6 => shape(
      'var' => 'floatVal',
      'is_terse' => true,
      'type' => \TType::FLOAT,
    ),
    -7 => shape(
      'var' => 'doubleVal',
      'is_terse' => true,
      'type' => \TType::DOUBLE,
    ),
    -8 => shape(
      'var' => 'stringVal',
      'is_terse' => true,
      'type' => \TType::STRING,
    ),
    -9 => shape(
      'var' => 'binaryVal',
      'is_terse' => true,
      'type' => \TType::STRING,
      'is_binary' => true,
    ),
    -10 => shape(
      'var' => 'enumVal',
      'is_terse' => true,
      'type' => \TType::I32,
      'enum' => \fixtures\patch\MyEnum::class,
    ),
    -11 => shape(
      'var' => 'structVal',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyData::class,
    ),
    -12 => shape(
      'var' => 'unionVal',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnion::class,
    ),
    -13 => shape(
      'var' => 'lateStructVal',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStruct::class,
    ),
    -14 => shape(
      'var' => 'durationVal',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \apache_thrift_type_standard_DurationStruct::class,
    ),
    -15 => shape(
      'var' => 'timeVal',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \apache_thrift_type_standard_TimeStruct::class,
    ),
    -16 => shape(
      'var' => 'optBoolVal',
      'type' => \TType::BOOL,
    ),
    -17 => shape(
      'var' => 'optByteVal',
      'type' => \TType::BYTE,
    ),
    -18 => shape(
      'var' => 'optI16Val',
      'type' => \TType::I16,
    ),
    -19 => shape(
      'var' => 'optI32Val',
      'type' => \TType::I32,
    ),
    -20 => shape(
      'var' => 'optI64Val',
      'type' => \TType::I64,
    ),
    -21 => shape(
      'var' => 'optFloatVal',
      'type' => \TType::FLOAT,
    ),
    -22 => shape(
      'var' => 'optDoubleVal',
      'type' => \TType::DOUBLE,
    ),
    -23 => shape(
      'var' => 'optStringVal',
      'type' => \TType::STRING,
    ),
    -24 => shape(
      'var' => 'optBinaryVal',
      'type' => \TType::STRING,
      'is_binary' => true,
    ),
    -25 => shape(
      'var' => 'optEnumVal',
      'type' => \TType::I32,
      'enum' => \fixtures\patch\MyEnum::class,
    ),
    -26 => shape(
      'var' => 'optStructVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyData::class,
    ),
    -27 => shape(
      'var' => 'optLateStructVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStruct::class,
    ),
    -28 => shape(
      'var' => 'optListVal',
      'type' => \TType::LST,
      'etype' => \TType::I16,
      'elem' => shape(
        'type' => \TType::I16,
      ),
      'format' => 'collection',
    ),
    -29 => shape(
      'var' => 'optSetVal',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    -30 => shape(
      'var' => 'optMapVal',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRING,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    -31 => shape(
      'var' => 'listMap',
      'is_terse' => true,
      'type' => \TType::LST,
      'etype' => \TType::MAP,
      'elem' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    -32 => shape(
      'var' => 'mapMap',
      'is_terse' => true,
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::MAP,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'boolVal' => -1,
    'byteVal' => -2,
    'i16Val' => -3,
    'i32Val' => -4,
    'i64Val' => -5,
    'floatVal' => -6,
    'doubleVal' => -7,
    'stringVal' => -8,
    'binaryVal' => -9,
    'enumVal' => -10,
    'structVal' => -11,
    'unionVal' => -12,
    'lateStructVal' => -13,
    'durationVal' => -14,
    'timeVal' => -15,
    'optBoolVal' => -16,
    'optByteVal' => -17,
    'optI16Val' => -18,
    'optI32Val' => -19,
    'optI64Val' => -20,
    'optFloatVal' => -21,
    'optDoubleVal' => -22,
    'optStringVal' => -23,
    'optBinaryVal' => -24,
    'optEnumVal' => -25,
    'optStructVal' => -26,
    'optLateStructVal' => -27,
    'optListVal' => -28,
    'optSetVal' => -29,
    'optMapVal' => -30,
    'listMap' => -31,
    'mapMap' => -32,
  ];

  const type TConstructorShape = shape(
    ?'boolVal' => ?bool,
    ?'byteVal' => ?int,
    ?'i16Val' => ?int,
    ?'i32Val' => ?int,
    ?'i64Val' => ?int,
    ?'floatVal' => ?float,
    ?'doubleVal' => ?float,
    ?'stringVal' => ?string,
    ?'binaryVal' => ?string,
    ?'enumVal' => ?\fixtures\patch\MyEnum,
    ?'structVal' => ?\fixtures\patch\MyData,
    ?'unionVal' => ?\fixtures\patch\MyUnion,
    ?'lateStructVal' => ?\fixtures\patch\LateDefStruct,
    ?'durationVal' => ?\apache_thrift_type_standard_DurationStruct,
    ?'timeVal' => ?\apache_thrift_type_standard_TimeStruct,
    ?'optBoolVal' => ?bool,
    ?'optByteVal' => ?int,
    ?'optI16Val' => ?int,
    ?'optI32Val' => ?int,
    ?'optI64Val' => ?int,
    ?'optFloatVal' => ?float,
    ?'optDoubleVal' => ?float,
    ?'optStringVal' => ?string,
    ?'optBinaryVal' => ?string,
    ?'optEnumVal' => ?\fixtures\patch\MyEnum,
    ?'optStructVal' => ?\fixtures\patch\MyData,
    ?'optLateStructVal' => ?\fixtures\patch\LateDefStruct,
    ?'optListVal' => ?Vector<int>,
    ?'optSetVal' => ?Set<string>,
    ?'optMapVal' => ?Map<string, string>,
    ?'listMap' => ?Vector<Map<string, int>>,
    ?'mapMap' => ?Map<string, Map<string, int>>,
  );

  const type TShape = shape(
    'boolVal' => bool,
    'byteVal' => int,
    'i16Val' => int,
    'i32Val' => int,
    'i64Val' => int,
    'floatVal' => float,
    'doubleVal' => float,
    'stringVal' => string,
    'binaryVal' => string,
    ?'enumVal' => ?\fixtures\patch\MyEnum,
    ?'structVal' => ?\fixtures\patch\MyData::TShape,
    ?'unionVal' => ?\fixtures\patch\MyUnion::TShape,
    ?'lateStructVal' => ?\fixtures\patch\LateDefStruct::TShape,
    ?'durationVal' => ?\apache_thrift_type_standard_DurationStruct::TShape,
    ?'timeVal' => ?\apache_thrift_type_standard_TimeStruct::TShape,
    ?'optBoolVal' => ?bool,
    ?'optByteVal' => ?int,
    ?'optI16Val' => ?int,
    ?'optI32Val' => ?int,
    ?'optI64Val' => ?int,
    ?'optFloatVal' => ?float,
    ?'optDoubleVal' => ?float,
    ?'optStringVal' => ?string,
    ?'optBinaryVal' => ?string,
    ?'optEnumVal' => ?\fixtures\patch\MyEnum,
    ?'optStructVal' => ?\fixtures\patch\MyData::TShape,
    ?'optLateStructVal' => ?\fixtures\patch\LateDefStruct::TShape,
    ?'optListVal' => ?vec<int>,
    ?'optSetVal' => ?dict<string, bool>,
    ?'optMapVal' => ?dict<string, string>,
    'listMap' => vec<dict<string, int>>,
    'mapMap' => dict<string, dict<string, int>>,
    ...
  );
  const int STRUCTURAL_ID = 8026955195810282487;
  /**
   * Original thrift field:-
   * -1: bool boolVal
   */
  public bool $boolVal;
  /**
   * Original thrift field:-
   * -2: byte byteVal
   */
  public int $byteVal;
  /**
   * Original thrift field:-
   * -3: i16 i16Val
   */
  public int $i16Val;
  /**
   * Original thrift field:-
   * -4: i32 i32Val
   */
  public int $i32Val;
  /**
   * Original thrift field:-
   * -5: i64 i64Val
   */
  public int $i64Val;
  /**
   * Original thrift field:-
   * -6: float floatVal
   */
  public float $floatVal;
  /**
   * Original thrift field:-
   * -7: double doubleVal
   */
  public float $doubleVal;
  /**
   * Original thrift field:-
   * -8: string stringVal
   */
  public string $stringVal;
  /**
   * Original thrift field:-
   * -9: binary binaryVal
   */
  public string $binaryVal;
  /**
   * Original thrift field:-
   * -10: enum module.MyEnum enumVal
   */
  public ?\fixtures\patch\MyEnum $enumVal;
  /**
   * Original thrift field:-
   * -11: struct module.MyData structVal
   */
  public ?\fixtures\patch\MyData $structVal;
  /**
   * Original thrift field:-
   * -12: struct module.MyUnion unionVal
   */
  public ?\fixtures\patch\MyUnion $unionVal;
  /**
   * Original thrift field:-
   * -13: struct module.LateDefStruct lateStructVal
   */
  public ?\fixtures\patch\LateDefStruct $lateStructVal;
  /**
   * Original thrift field:-
   * -14: struct standard.DurationStruct durationVal
   */
  public ?\apache_thrift_type_standard_DurationStruct $durationVal;
  /**
   * Original thrift field:-
   * -15: struct standard.TimeStruct timeVal
   */
  public ?\apache_thrift_type_standard_TimeStruct $timeVal;
  /**
   * Original thrift field:-
   * -16: bool optBoolVal
   */
  public ?bool $optBoolVal;
  /**
   * Original thrift field:-
   * -17: byte optByteVal
   */
  public ?int $optByteVal;
  /**
   * Original thrift field:-
   * -18: i16 optI16Val
   */
  public ?int $optI16Val;
  /**
   * Original thrift field:-
   * -19: i32 optI32Val
   */
  public ?int $optI32Val;
  /**
   * Original thrift field:-
   * -20: i64 optI64Val
   */
  public ?int $optI64Val;
  /**
   * Original thrift field:-
   * -21: float optFloatVal
   */
  public ?float $optFloatVal;
  /**
   * Original thrift field:-
   * -22: double optDoubleVal
   */
  public ?float $optDoubleVal;
  /**
   * Original thrift field:-
   * -23: string optStringVal
   */
  public ?string $optStringVal;
  /**
   * Original thrift field:-
   * -24: binary optBinaryVal
   */
  public ?string $optBinaryVal;
  /**
   * Original thrift field:-
   * -25: enum module.MyEnum optEnumVal
   */
  public ?\fixtures\patch\MyEnum $optEnumVal;
  /**
   * Original thrift field:-
   * -26: struct module.MyData optStructVal
   */
  public ?\fixtures\patch\MyData $optStructVal;
  /**
   * Original thrift field:-
   * -27: struct module.LateDefStruct optLateStructVal
   */
  public ?\fixtures\patch\LateDefStruct $optLateStructVal;
  /**
   * Original thrift field:-
   * -28: list<i16> optListVal
   */
  public ?Vector<int> $optListVal;
  /**
   * Original thrift field:-
   * -29: set<string> optSetVal
   */
  public ?Set<string> $optSetVal;
  /**
   * Original thrift field:-
   * -30: map<string, string> optMapVal
   */
  public ?Map<string, string> $optMapVal;
  /**
   * Original thrift field:-
   * -31: list<map<string, i32>> listMap
   */
  public Vector<Map<string, int>> $listMap;
  /**
   * Original thrift field:-
   * -32: map<string, map<string, i32>> mapMap
   */
  public Map<string, Map<string, int>> $mapMap;

  public function __construct(?bool $boolVal = null, ?int $byteVal = null, ?int $i16Val = null, ?int $i32Val = null, ?int $i64Val = null, ?float $floatVal = null, ?float $doubleVal = null, ?string $stringVal = null, ?string $binaryVal = null, ?\fixtures\patch\MyEnum $enumVal = null, ?\fixtures\patch\MyData $structVal = null, ?\fixtures\patch\MyUnion $unionVal = null, ?\fixtures\patch\LateDefStruct $lateStructVal = null, ?\apache_thrift_type_standard_DurationStruct $durationVal = null, ?\apache_thrift_type_standard_TimeStruct $timeVal = null, ?bool $optBoolVal = null, ?int $optByteVal = null, ?int $optI16Val = null, ?int $optI32Val = null, ?int $optI64Val = null, ?float $optFloatVal = null, ?float $optDoubleVal = null, ?string $optStringVal = null, ?string $optBinaryVal = null, ?\fixtures\patch\MyEnum $optEnumVal = null, ?\fixtures\patch\MyData $optStructVal = null, ?\fixtures\patch\LateDefStruct $optLateStructVal = null, ?Vector<int> $optListVal = null, ?Set<string> $optSetVal = null, ?Map<string, string> $optMapVal = null, ?Vector<Map<string, int>> $listMap = null, ?Map<string, Map<string, int>> $mapMap = null)[] {
    $this->boolVal = $boolVal ?? false;
    $this->byteVal = $byteVal ?? 0;
    $this->i16Val = $i16Val ?? 0;
    $this->i32Val = $i32Val ?? 0;
    $this->i64Val = $i64Val ?? 0;
    $this->floatVal = $floatVal ?? 0.0;
    $this->doubleVal = $doubleVal ?? 0.0;
    $this->stringVal = $stringVal ?? '';
    $this->binaryVal = $binaryVal ?? '';
    $this->enumVal = $enumVal;
    $this->structVal = $structVal;
    $this->unionVal = $unionVal;
    $this->lateStructVal = $lateStructVal;
    $this->durationVal = $durationVal;
    $this->timeVal = $timeVal;
    $this->optBoolVal = $optBoolVal;
    $this->optByteVal = $optByteVal;
    $this->optI16Val = $optI16Val;
    $this->optI32Val = $optI32Val;
    $this->optI64Val = $optI64Val;
    $this->optFloatVal = $optFloatVal;
    $this->optDoubleVal = $optDoubleVal;
    $this->optStringVal = $optStringVal;
    $this->optBinaryVal = $optBinaryVal;
    $this->optEnumVal = $optEnumVal;
    $this->optStructVal = $optStructVal;
    $this->optLateStructVal = $optLateStructVal;
    $this->optListVal = $optListVal;
    $this->optSetVal = $optSetVal;
    $this->optMapVal = $optMapVal;
    $this->listMap = $listMap ?? Vector {};
    $this->mapMap = $mapMap ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'boolVal'),
      Shapes::idx($shape, 'byteVal'),
      Shapes::idx($shape, 'i16Val'),
      Shapes::idx($shape, 'i32Val'),
      Shapes::idx($shape, 'i64Val'),
      Shapes::idx($shape, 'floatVal'),
      Shapes::idx($shape, 'doubleVal'),
      Shapes::idx($shape, 'stringVal'),
      Shapes::idx($shape, 'binaryVal'),
      Shapes::idx($shape, 'enumVal'),
      Shapes::idx($shape, 'structVal'),
      Shapes::idx($shape, 'unionVal'),
      Shapes::idx($shape, 'lateStructVal'),
      Shapes::idx($shape, 'durationVal'),
      Shapes::idx($shape, 'timeVal'),
      Shapes::idx($shape, 'optBoolVal'),
      Shapes::idx($shape, 'optByteVal'),
      Shapes::idx($shape, 'optI16Val'),
      Shapes::idx($shape, 'optI32Val'),
      Shapes::idx($shape, 'optI64Val'),
      Shapes::idx($shape, 'optFloatVal'),
      Shapes::idx($shape, 'optDoubleVal'),
      Shapes::idx($shape, 'optStringVal'),
      Shapes::idx($shape, 'optBinaryVal'),
      Shapes::idx($shape, 'optEnumVal'),
      Shapes::idx($shape, 'optStructVal'),
      Shapes::idx($shape, 'optLateStructVal'),
      Shapes::idx($shape, 'optListVal'),
      Shapes::idx($shape, 'optSetVal'),
      Shapes::idx($shape, 'optMapVal'),
      Shapes::idx($shape, 'listMap'),
      Shapes::idx($shape, 'mapMap'),
    );
  }

  public function getName()[]: string {
    return 'MyStruct';
  }

  public function clearTerseFields()[write_props]: void {
    $this->boolVal = false;
    $this->byteVal = 0;
    $this->i16Val = 0;
    $this->i32Val = 0;
    $this->i64Val = 0;
    $this->floatVal = 0.0;
    $this->doubleVal = 0.0;
    $this->stringVal = '';
    $this->binaryVal = '';
    $this->enumVal = null;
    $this->structVal = null;
    $this->unionVal = null;
    $this->lateStructVal = null;
    $this->durationVal = null;
    $this->timeVal = null;
    $this->listMap = Vector {};
    $this->mapMap = Map {};
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStruct",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "boolVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BYTE_TYPE,
                )
              ),
              "name" => "byteVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                )
              ),
              "name" => "i16Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -4,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                )
              ),
              "name" => "i32Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I64_TYPE,
                )
              ),
              "name" => "i64Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_FLOAT_TYPE,
                )
              ),
              "name" => "floatVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_DOUBLE_TYPE,
                )
              ),
              "name" => "doubleVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -8,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "stringVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BINARY_TYPE,
                )
              ),
              "name" => "binaryVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -10,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_enum" => \tmeta_ThriftEnumType::fromShape(
                    shape(
                      "name" => "module.MyEnum",
                    )
                  ),
                )
              ),
              "name" => "enumVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -11,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyData",
                    )
                  ),
                )
              ),
              "name" => "structVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -12,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnion",
                    )
                  ),
                )
              ),
              "name" => "unionVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -13,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.LateDefStruct",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.LateDefStruct",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "lateStructVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -14,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "standard.DurationStruct",
                    )
                  ),
                )
              ),
              "name" => "durationVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -15,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "standard.TimeStruct",
                    )
                  ),
                )
              ),
              "name" => "timeVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -16,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "optBoolVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -17,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BYTE_TYPE,
                )
              ),
              "name" => "optByteVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -18,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                )
              ),
              "name" => "optI16Val",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -19,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                )
              ),
              "name" => "optI32Val",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -20,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I64_TYPE,
                )
              ),
              "name" => "optI64Val",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -21,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_FLOAT_TYPE,
                )
              ),
              "name" => "optFloatVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -22,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_DOUBLE_TYPE,
                )
              ),
              "name" => "optDoubleVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -23,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                )
              ),
              "name" => "optStringVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -24,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BINARY_TYPE,
                )
              ),
              "name" => "optBinaryVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -25,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_enum" => \tmeta_ThriftEnumType::fromShape(
                    shape(
                      "name" => "module.MyEnum",
                    )
                  ),
                )
              ),
              "name" => "optEnumVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -26,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyData",
                    )
                  ),
                )
              ),
              "name" => "optStructVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -27,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.LateDefStruct",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.LateDefStruct",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "optLateStructVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -28,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "optListVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -29,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "optSetVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -30,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "optMapVal",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -31,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "listMap",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -32,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "mapMap",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\Testing' => \thrift\annotation\Testing::fromShape(
          shape(
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      $shape['boolVal'],
      $shape['byteVal'],
      $shape['i16Val'],
      $shape['i32Val'],
      $shape['i64Val'],
      $shape['floatVal'],
      $shape['doubleVal'],
      $shape['stringVal'],
      $shape['binaryVal'],
      Shapes::idx($shape, 'enumVal'),
      Shapes::idx($shape, 'structVal') === null ? null : (\fixtures\patch\MyData::__fromShape($shape['structVal'])),
      Shapes::idx($shape, 'unionVal') === null ? null : (\fixtures\patch\MyUnion::__fromShape($shape['unionVal'])),
      Shapes::idx($shape, 'lateStructVal') === null ? null : (\fixtures\patch\LateDefStruct::__fromShape($shape['lateStructVal'])),
      Shapes::idx($shape, 'durationVal') === null ? null : (\apache_thrift_type_standard_DurationStruct::__fromShape($shape['durationVal'])),
      Shapes::idx($shape, 'timeVal') === null ? null : (\apache_thrift_type_standard_TimeStruct::__fromShape($shape['timeVal'])),
      Shapes::idx($shape, 'optBoolVal'),
      Shapes::idx($shape, 'optByteVal'),
      Shapes::idx($shape, 'optI16Val'),
      Shapes::idx($shape, 'optI32Val'),
      Shapes::idx($shape, 'optI64Val'),
      Shapes::idx($shape, 'optFloatVal'),
      Shapes::idx($shape, 'optDoubleVal'),
      Shapes::idx($shape, 'optStringVal'),
      Shapes::idx($shape, 'optBinaryVal'),
      Shapes::idx($shape, 'optEnumVal'),
      Shapes::idx($shape, 'optStructVal') === null ? null : (\fixtures\patch\MyData::__fromShape($shape['optStructVal'])),
      Shapes::idx($shape, 'optLateStructVal') === null ? null : (\fixtures\patch\LateDefStruct::__fromShape($shape['optLateStructVal'])),
      Shapes::idx($shape, 'optListVal') === null ? null : ((new Vector($shape['optListVal']))),
      Shapes::idx($shape, 'optSetVal') === null ? null : (new Set(Keyset\keys($shape['optSetVal']))),
      Shapes::idx($shape, 'optMapVal') === null ? null : ((new Map($shape['optMapVal']))),
      (new Vector($shape['listMap']))->map(
        $val0 ==> (new Map($val0)),
      ),
      (new Map($shape['mapMap']))->map(
        $val1 ==> (new Map($val1)),
      ),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'boolVal' => $this->boolVal,
      'byteVal' => $this->byteVal,
      'i16Val' => $this->i16Val,
      'i32Val' => $this->i32Val,
      'i64Val' => $this->i64Val,
      'floatVal' => $this->floatVal,
      'doubleVal' => $this->doubleVal,
      'stringVal' => $this->stringVal,
      'binaryVal' => $this->binaryVal,
      'enumVal' => $this->enumVal,
      'structVal' => $this->structVal?->__toShape(),
      'unionVal' => $this->unionVal?->__toShape(),
      'lateStructVal' => $this->lateStructVal?->__toShape(),
      'durationVal' => $this->durationVal?->__toShape(),
      'timeVal' => $this->timeVal?->__toShape(),
      'optBoolVal' => $this->optBoolVal,
      'optByteVal' => $this->optByteVal,
      'optI16Val' => $this->optI16Val,
      'optI32Val' => $this->optI32Val,
      'optI64Val' => $this->optI64Val,
      'optFloatVal' => $this->optFloatVal,
      'optDoubleVal' => $this->optDoubleVal,
      'optStringVal' => $this->optStringVal,
      'optBinaryVal' => $this->optBinaryVal,
      'optEnumVal' => $this->optEnumVal,
      'optStructVal' => $this->optStructVal?->__toShape(),
      'optLateStructVal' => $this->optLateStructVal?->__toShape(),
      'optListVal' => $this->optListVal
        |> $$ === null ? null : vec($$),
      'optSetVal' => $this->optSetVal
        |> $$ === null ? null : ThriftUtil::toDArray(Dict\fill_keys($$->toValuesArray(), true), static::class),
      'optMapVal' => $this->optMapVal
        |> $$ === null ? null : dict($$),
      'listMap' => $this->listMap->map(
        ($_val0) ==> dict($_val0),
      )
        |> vec($$),
      'mapMap' => $this->mapMap->map(
        ($_val0) ==> dict($_val0),
      )
        |> dict($$),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'boolVal') !== null) {
      $this->boolVal = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['boolVal']);
    }
    if (idx($parsed, 'byteVal') !== null) {
      $_tmp0 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['byteVal']);
      if ($_tmp0 > 0x7f) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->byteVal = (int)$_tmp0;
      }
    }
    if (idx($parsed, 'i16Val') !== null) {
      $_tmp1 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['i16Val']);
      if ($_tmp1 > 0x7fff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->i16Val = (int)$_tmp1;
      }
    }
    if (idx($parsed, 'i32Val') !== null) {
      $_tmp2 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['i32Val']);
      if ($_tmp2 > 0x7fffffff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->i32Val = (int)$_tmp2;
      }
    }
    if (idx($parsed, 'i64Val') !== null) {
      $this->i64Val = HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['i64Val']);
    }
    if (idx($parsed, 'floatVal') !== null) {
      $this->floatVal = HH\FIXME\UNSAFE_CAST<mixed, float>($parsed['floatVal']);
    }
    if (idx($parsed, 'doubleVal') !== null) {
      $this->doubleVal = HH\FIXME\UNSAFE_CAST<mixed, float>($parsed['doubleVal']);
    }
    if (idx($parsed, 'stringVal') !== null) {
      $this->stringVal = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['stringVal']);
    }
    if (idx($parsed, 'binaryVal') !== null) {
      $this->binaryVal = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['binaryVal']);
    }
    if (idx($parsed, 'enumVal') !== null) {
      $this->enumVal = \fixtures\patch\MyEnum::coerce(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyEnum>($parsed['enumVal']));
    }
    if (idx($parsed, 'structVal') !== null) {
      $_tmp3 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyData>($parsed['structVal']));
      $_tmp4 = \fixtures\patch\MyData::withDefaultValues();
      $_tmp4->readFromJson($_tmp3);
      $this->structVal = $_tmp4;
    }
    if (idx($parsed, 'unionVal') !== null) {
      $_tmp5 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnion>($parsed['unionVal']));
      $_tmp6 = \fixtures\patch\MyUnion::withDefaultValues();
      $_tmp6->readFromJson($_tmp5);
      $this->unionVal = $_tmp6;
    }
    if (idx($parsed, 'lateStructVal') !== null) {
      $_tmp7 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStruct>($parsed['lateStructVal']));
      $_tmp8 = \fixtures\patch\LateDefStruct::withDefaultValues();
      $_tmp8->readFromJson($_tmp7);
      $this->lateStructVal = $_tmp8;
    }
    if (idx($parsed, 'durationVal') !== null) {
      $_tmp9 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \apache_thrift_type_standard_DurationStruct>($parsed['durationVal']));
      $_tmp10 = \apache_thrift_type_standard_DurationStruct::withDefaultValues();
      $_tmp10->readFromJson($_tmp9);
      $this->durationVal = $_tmp10;
    }
    if (idx($parsed, 'timeVal') !== null) {
      $_tmp11 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \apache_thrift_type_standard_TimeStruct>($parsed['timeVal']));
      $_tmp12 = \apache_thrift_type_standard_TimeStruct::withDefaultValues();
      $_tmp12->readFromJson($_tmp11);
      $this->timeVal = $_tmp12;
    }
    if (idx($parsed, 'optBoolVal') !== null) {
      $this->optBoolVal = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['optBoolVal']);
    }
    if (idx($parsed, 'optByteVal') !== null) {
      $_tmp13 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['optByteVal']);
      if ($_tmp13 > 0x7f) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->optByteVal = (int)$_tmp13;
      }
    }
    if (idx($parsed, 'optI16Val') !== null) {
      $_tmp14 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['optI16Val']);
      if ($_tmp14 > 0x7fff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->optI16Val = (int)$_tmp14;
      }
    }
    if (idx($parsed, 'optI32Val') !== null) {
      $_tmp15 = (int)HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['optI32Val']);
      if ($_tmp15 > 0x7fffffff) {
        throw new \TProtocolException("number exceeds limit in field");
      } else {
        $this->optI32Val = (int)$_tmp15;
      }
    }
    if (idx($parsed, 'optI64Val') !== null) {
      $this->optI64Val = HH\FIXME\UNSAFE_CAST<mixed, int>($parsed['optI64Val']);
    }
    if (idx($parsed, 'optFloatVal') !== null) {
      $this->optFloatVal = HH\FIXME\UNSAFE_CAST<mixed, float>($parsed['optFloatVal']);
    }
    if (idx($parsed, 'optDoubleVal') !== null) {
      $this->optDoubleVal = HH\FIXME\UNSAFE_CAST<mixed, float>($parsed['optDoubleVal']);
    }
    if (idx($parsed, 'optStringVal') !== null) {
      $this->optStringVal = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['optStringVal']);
    }
    if (idx($parsed, 'optBinaryVal') !== null) {
      $this->optBinaryVal = HH\FIXME\UNSAFE_CAST<mixed, string>($parsed['optBinaryVal']);
    }
    if (idx($parsed, 'optEnumVal') !== null) {
      $this->optEnumVal = \fixtures\patch\MyEnum::coerce(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyEnum>($parsed['optEnumVal']));
    }
    if (idx($parsed, 'optStructVal') !== null) {
      $_tmp16 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyData>($parsed['optStructVal']));
      $_tmp17 = \fixtures\patch\MyData::withDefaultValues();
      $_tmp17->readFromJson($_tmp16);
      $this->optStructVal = $_tmp17;
    }
    if (idx($parsed, 'optLateStructVal') !== null) {
      $_tmp18 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStruct>($parsed['optLateStructVal']));
      $_tmp19 = \fixtures\patch\LateDefStruct::withDefaultValues();
      $_tmp19->readFromJson($_tmp18);
      $this->optLateStructVal = $_tmp19;
    }
    if (idx($parsed, 'optListVal') !== null) {
      $_json23 = HH\FIXME\UNSAFE_CAST<mixed, Vector<int>>($parsed['optListVal']);
      $_container24 = Vector {};
      foreach($_json23 as $_key21 => $_value22) {
        $_elem25 = 0;
        $_tmp26 = (int)$_value22;
        if ($_tmp26 > 0x7fff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_elem25 = (int)$_tmp26;
        }
        $_container24 []= $_elem25;
      }
      $this->optListVal = $_container24;
    }
    if (idx($parsed, 'optSetVal') !== null) {
      $_json30 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['optSetVal']);
      $_container31 = Set {};
      foreach($_json30 as $_key28 => $_value29) {
        $_elem32 = '';
        $_elem32 = $_value29;
        $_container31->add($_elem32);
      }
      $this->optSetVal = $_container31;
    }
    if (idx($parsed, 'optMapVal') !== null) {
      $_json36 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, string>>($parsed['optMapVal']);
      $_container37 = Map {};
      foreach($_json36 as $_key34 => $_value35) {
        $_value38 = '';
        $_value38 = $_value35;
        $_container37[$_key34] = $_value38;
      }
      $this->optMapVal = $_container37;
    }
    if (idx($parsed, 'listMap') !== null) {
      $_json42 = HH\FIXME\UNSAFE_CAST<mixed, Vector<Map<string, int>>>($parsed['listMap']);
      $_container43 = Vector {};
      foreach($_json42 as $_key40 => $_value41) {
        $_elem44 = Map {};
        $_json48 = $_value41;
        $_container49 = Map {};
        foreach($_json48 as $_key46 => $_value47) {
          $_value50 = 0;
          $_tmp51 = (int)$_value47;
          if ($_tmp51 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value50 = (int)$_tmp51;
          }
          $_container49[$_key46] = $_value50;
        }
        $_elem44 = $_container49;
        $_container43 []= $_elem44;
      }
      $this->listMap = $_container43;
    }
    if (idx($parsed, 'mapMap') !== null) {
      $_json55 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, Map<string, int>>>($parsed['mapMap']);
      $_container56 = Map {};
      foreach($_json55 as $_key53 => $_value54) {
        $_value57 = Map {};
        $_json61 = $_value54;
        $_container62 = Map {};
        foreach($_json61 as $_key59 => $_value60) {
          $_value63 = 0;
          $_tmp64 = (int)$_value60;
          if ($_tmp64 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value63 = (int)$_tmp64;
          }
          $_container62[$_key59] = $_value63;
        }
        $_value57 = $_container62;
        $_container56[$_key53] = $_value57;
      }
      $this->mapMap = $_container56;
    }
  }

}

/**
 * Original thrift struct:-
 * LateDefStruct
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/LateDefStruct'))>>
class LateDefStruct implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
  ];
  const dict<string, int> FIELDMAP = dict[
  ];

  const type TConstructorShape = shape(
  );

  const type TShape = shape(
    ...
  );
  const int STRUCTURAL_ID = 957977401221134810;

  public function __construct()[] {
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
    );
  }

  public function getName()[]: string {
    return 'LateDefStruct';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.LateDefStruct",
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

  }

}

/**
 * Original thrift struct:-
 * Recursive
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/Recursive'))>>
class Recursive implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'nodes',
      'is_terse' => true,
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \fixtures\patch\Recursive::class,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'nodes' => -1,
  ];

  const type TConstructorShape = shape(
    ?'nodes' => ?Map<string, \fixtures\patch\Recursive>,
  );

  const type TShape = shape(
    'nodes' => dict<string, \fixtures\patch\Recursive::TShape>,
    ...
  );
  const int STRUCTURAL_ID = 6832467362236085104;
  /**
   * Original thrift field:-
   * -1: map<string, struct module.Recursive> nodes
   */
  public Map<string, \fixtures\patch\Recursive> $nodes;

  public function __construct(?Map<string, \fixtures\patch\Recursive> $nodes = null)[] {
    $this->nodes = $nodes ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'nodes'),
    );
  }

  public function getName()[]: string {
    return 'Recursive';
  }

  public function clearTerseFields()[write_props]: void {
    $this->nodes = Map {};
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.Recursive",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                            shape(
                              "name" => "module.Recursive",
                              "underlyingType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                                    shape(
                                      "name" => "module.Recursive",
                                    )
                                  ),
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "nodes",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
        'nodes' => shape(
          'field' => dict[
            '\thrift\op\AssignOnlyPatch' => \thrift\op\AssignOnlyPatch::fromShape(
              shape(
              )
            ),
          ],
          'type' => dict[],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      (new Map($shape['nodes']))->map(
        $val0 ==> \fixtures\patch\Recursive::__fromShape($val0),
      ),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'nodes' => $this->nodes->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'nodes') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \fixtures\patch\Recursive>>($parsed['nodes']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = \fixtures\patch\Recursive::withDefaultValues();
        $_tmp6 = \json_encode($_value2);
        $_tmp7 = \fixtures\patch\Recursive::withDefaultValues();
        $_tmp7->readFromJson($_tmp6);
        $_value5 = $_tmp7;
        $_container4[$_key1] = $_value5;
      }
      $this->nodes = $_container4;
    }
  }

}

/**
 * Original thrift struct:-
 * Bar
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/Bar'))>>
class Bar implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'loop',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Loop::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'loop' => -1,
  ];

  const type TConstructorShape = shape(
    ?'loop' => ?\fixtures\patch\Loop,
  );

  const type TShape = shape(
    ?'loop' => ?\fixtures\patch\Loop::TShape,
    ...
  );
  const int STRUCTURAL_ID = 418974100266768802;
  /**
   * Original thrift field:-
   * -1: struct module.Loop loop
   */
  public ?\fixtures\patch\Loop $loop;

  public function __construct(?\fixtures\patch\Loop $loop = null)[] {
    $this->loop = $loop;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'loop'),
    );
  }

  public function getName()[]: string {
    return 'Bar';
  }

  public function clearTerseFields()[write_props]: void {
    $this->loop = null;
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.Bar",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.Loop",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.Loop",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "loop",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[],
      'fields' => dict[
        'loop' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\op\AssignOnlyPatch' => \thrift\op\AssignOnlyPatch::fromShape(
              shape(
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'loop') === null ? null : (\fixtures\patch\Loop::__fromShape($shape['loop'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'loop' => $this->loop?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'loop') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Loop>($parsed['loop']));
      $_tmp1 = \fixtures\patch\Loop::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->loop = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * Loop
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/Loop'))>>
class Loop implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'bar',
      'is_terse' => true,
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Bar::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'bar' => -1,
  ];

  const type TConstructorShape = shape(
    ?'bar' => ?\fixtures\patch\Bar,
  );

  const type TShape = shape(
    ?'bar' => ?\fixtures\patch\Bar::TShape,
    ...
  );
  const int STRUCTURAL_ID = 3942468431999341434;
  /**
   * Original thrift field:-
   * -1: struct module.Bar bar
   */
  public ?\fixtures\patch\Bar $bar;

  public function __construct(?\fixtures\patch\Bar $bar = null)[] {
    $this->bar = $bar;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'bar'),
    );
  }

  public function getName()[]: string {
    return 'Loop';
  }

  public function clearTerseFields()[write_props]: void {
    $this->bar = null;
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.Loop",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Bar",
                    )
                  ),
                )
              ),
              "name" => "bar",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\op\AssignOnlyPatch' => \thrift\op\AssignOnlyPatch::fromShape(
          shape(
          )
        ),
      ],
      'fields' => dict[
        'bar' => shape(
          'field' => dict[
            '\thrift\op\AssignOnlyPatch' => \thrift\op\AssignOnlyPatch::fromShape(
              shape(
              )
            ),
          ],
          'type' => dict[],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'bar') === null ? null : (\fixtures\patch\Bar::__fromShape($shape['bar'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'bar' => $this->bar?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'bar') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Bar>($parsed['bar']));
      $_tmp1 = \fixtures\patch\Bar::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->bar = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * MyDataFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyDataFieldPatch'))>>
class MyDataFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'data1',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\StringPatch::class,
    ),
    2 => shape(
      'var' => 'data2',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I32Patch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'data1' => 1,
    'data2' => 2,
  ];

  const type TConstructorShape = shape(
    ?'data1' => ?\thrift\op\StringPatch,
    ?'data2' => ?\thrift\op\I32Patch,
  );

  const type TShape = shape(
    ?'data1' => ?\thrift\op\StringPatch::TShape,
    ?'data2' => ?\thrift\op\I32Patch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 4934641526205074734;
  /**
   * Original thrift field:-
   * 1: struct patch.StringPatch data1
   */
  public ?\thrift\op\StringPatch $data1;
  /**
   * Original thrift field:-
   * 2: struct patch.I32Patch data2
   */
  public ?\thrift\op\I32Patch $data2;

  public function __construct(?\thrift\op\StringPatch $data1 = null, ?\thrift\op\I32Patch $data2 = null)[] {
    $this->data1 = $data1;
    $this->data2 = $data2;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'data1'),
      Shapes::idx($shape, 'data2'),
    );
  }

  public function getName()[]: string {
    return 'MyDataFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyDataFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.StringPatch",
                    )
                  ),
                )
              ),
              "name" => "data1",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I32Patch",
                    )
                  ),
                )
              ),
              "name" => "data2",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "MyDataFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'data1' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StringPatchAdapter",
                "underlyingName" => "StringPatchStruct",
              )
            ),
          ],
        ),
        'data2' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I32PatchStruct",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'data1') === null ? null : (\thrift\op\StringPatch::__fromShape($shape['data1'])),
      Shapes::idx($shape, 'data2') === null ? null : (\thrift\op\I32Patch::__fromShape($shape['data2'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'data1' => $this->data1?->__toShape(),
      'data2' => $this->data2?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'data1') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\StringPatch>($parsed['data1']));
      $_tmp1 = \thrift\op\StringPatch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->data1 = $_tmp1;
    }
    if (idx($parsed, 'data2') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I32Patch>($parsed['data2']));
      $_tmp3 = \thrift\op\I32Patch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->data2 = $_tmp3;
    }
  }

}

/**
 * Original thrift struct:-
 * MyDataPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyDataPatch'))>>
class MyDataPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyData::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyDataFieldPatch::class,
    ),
    5 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyData::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyDataFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 5,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\MyData,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\MyDataFieldPatch,
    ?'ensure' => ?\fixtures\patch\MyData,
    ?'patch' => ?\fixtures\patch\MyDataFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\MyData::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\MyDataFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\MyData::TShape,
    ?'patch' => ?\fixtures\patch\MyDataFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 5256392352261057461;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.MyData assign
   */
  public ?\fixtures\patch\MyData $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.MyDataFieldPatch patchPrior
   */
  public ?\fixtures\patch\MyDataFieldPatch $patchPrior;
  /**
   * Initialize fields, using the given defaults. Applies third.
   * 
   * Original thrift field:-
   * 5: struct module.MyData ensure
   */
  public ?\fixtures\patch\MyData $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.MyDataFieldPatch patch
   */
  public ?\fixtures\patch\MyDataFieldPatch $patch;

  public function __construct(?\fixtures\patch\MyData $assign = null, ?bool $clear = null, ?\fixtures\patch\MyDataFieldPatch $patchPrior = null, ?\fixtures\patch\MyData $ensure = null, ?\fixtures\patch\MyDataFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'MyDataPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyDataPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyData",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyDataFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyData",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyDataFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::StructPatchAdapter",
            "underlyingName" => "MyDataPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyDataFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyDataFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\MyData::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\MyDataFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\MyData::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\MyDataFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyData>($parsed['assign']));
      $_tmp1 = \fixtures\patch\MyData::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyDataFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\MyDataFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyData>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\MyData::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyDataFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\MyDataFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * InnerUnionFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/InnerUnionFieldPatch'))>>
class InnerUnionFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'innerOption',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BinaryPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'innerOption' => 1,
  ];

  const type TConstructorShape = shape(
    ?'innerOption' => ?\thrift\op\BinaryPatch,
  );

  const type TShape = shape(
    ?'innerOption' => ?\thrift\op\BinaryPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 32095888299770904;
  /**
   * Original thrift field:-
   * 1: struct patch.BinaryPatch innerOption
   */
  public ?\thrift\op\BinaryPatch $innerOption;

  public function __construct(?\thrift\op\BinaryPatch $innerOption = null)[] {
    $this->innerOption = $innerOption;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'innerOption'),
    );
  }

  public function getName()[]: string {
    return 'InnerUnionFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.InnerUnionFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BinaryPatch",
                    )
                  ),
                )
              ),
              "name" => "innerOption",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "InnerUnionFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'innerOption' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::BinaryPatchAdapter",
                "underlyingName" => "BinaryPatchStruct",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'innerOption') === null ? null : (\thrift\op\BinaryPatch::__fromShape($shape['innerOption'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'innerOption' => $this->innerOption?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'innerOption') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BinaryPatch>($parsed['innerOption']));
      $_tmp1 = \thrift\op\BinaryPatch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->innerOption = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * InnerUnionPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/InnerUnionPatch'))>>
class InnerUnionPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnion::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnionFieldPatch::class,
    ),
    4 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnion::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnionFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 4,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\InnerUnion,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\InnerUnionFieldPatch,
    ?'ensure' => ?\fixtures\patch\InnerUnion,
    ?'patch' => ?\fixtures\patch\InnerUnionFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\InnerUnion::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\InnerUnionFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\InnerUnion::TShape,
    ?'patch' => ?\fixtures\patch\InnerUnionFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 6617672747921804043;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.InnerUnion assign
   */
  public ?\fixtures\patch\InnerUnion $assign;
  /**
   * Clears any set value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.InnerUnionFieldPatch patchPrior
   */
  public ?\fixtures\patch\InnerUnionFieldPatch $patchPrior;
  /**
   * Assigns the value, if not already set to the same field. Applies third.
   * 
   * Original thrift field:-
   * 4: struct module.InnerUnion ensure
   */
  public ?\fixtures\patch\InnerUnion $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.InnerUnionFieldPatch patch
   */
  public ?\fixtures\patch\InnerUnionFieldPatch $patch;

  public function __construct(?\fixtures\patch\InnerUnion $assign = null, ?bool $clear = null, ?\fixtures\patch\InnerUnionFieldPatch $patchPrior = null, ?\fixtures\patch\InnerUnion $ensure = null, ?\fixtures\patch\InnerUnionFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'InnerUnionPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.InnerUnionPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnion",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnionFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 4,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnion",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnionFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::UnionPatchAdapter",
            "underlyingName" => "InnerUnionPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "InnerUnionFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "InnerUnionFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\InnerUnion::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\InnerUnionFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\InnerUnion::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\InnerUnionFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnion>($parsed['assign']));
      $_tmp1 = \fixtures\patch\InnerUnion::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnionFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\InnerUnionFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnion>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\InnerUnion::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnionFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\InnerUnionFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * MyUnionFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyUnionFieldPatch'))>>
class MyUnionFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'option1',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\StringPatch::class,
    ),
    2 => shape(
      'var' => 'option2',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I32Patch::class,
    ),
    3 => shape(
      'var' => 'option3',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\InnerUnionPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'option1' => 1,
    'option2' => 2,
    'option3' => 3,
  ];

  const type TConstructorShape = shape(
    ?'option1' => ?\thrift\op\StringPatch,
    ?'option2' => ?\thrift\op\I32Patch,
    ?'option3' => ?\fixtures\patch\InnerUnionPatch,
  );

  const type TShape = shape(
    ?'option1' => ?\thrift\op\StringPatch::TShape,
    ?'option2' => ?\thrift\op\I32Patch::TShape,
    ?'option3' => ?\fixtures\patch\InnerUnionPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 7680965517871361038;
  /**
   * Original thrift field:-
   * 1: struct patch.StringPatch option1
   */
  public ?\thrift\op\StringPatch $option1;
  /**
   * Original thrift field:-
   * 2: struct patch.I32Patch option2
   */
  public ?\thrift\op\I32Patch $option2;
  /**
   * Original thrift field:-
   * 3: struct module.InnerUnionPatch option3
   */
  public ?\fixtures\patch\InnerUnionPatch $option3;

  public function __construct(?\thrift\op\StringPatch $option1 = null, ?\thrift\op\I32Patch $option2 = null, ?\fixtures\patch\InnerUnionPatch $option3 = null)[] {
    $this->option1 = $option1;
    $this->option2 = $option2;
    $this->option3 = $option3;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'option1'),
      Shapes::idx($shape, 'option2'),
      Shapes::idx($shape, 'option3'),
    );
  }

  public function getName()[]: string {
    return 'MyUnionFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyUnionFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.StringPatch",
                    )
                  ),
                )
              ),
              "name" => "option1",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I32Patch",
                    )
                  ),
                )
              ),
              "name" => "option2",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.InnerUnionPatch",
                    )
                  ),
                )
              ),
              "name" => "option3",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "MyUnionFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'option1' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StringPatchAdapter",
                "underlyingName" => "StringPatchStruct",
              )
            ),
          ],
        ),
        'option2' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I32PatchStruct",
              )
            ),
          ],
        ),
        'option3' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::UnionPatchAdapter",
                "underlyingName" => "InnerUnionPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'option1') === null ? null : (\thrift\op\StringPatch::__fromShape($shape['option1'])),
      Shapes::idx($shape, 'option2') === null ? null : (\thrift\op\I32Patch::__fromShape($shape['option2'])),
      Shapes::idx($shape, 'option3') === null ? null : (\fixtures\patch\InnerUnionPatch::__fromShape($shape['option3'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'option1' => $this->option1?->__toShape(),
      'option2' => $this->option2?->__toShape(),
      'option3' => $this->option3?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'option1') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\StringPatch>($parsed['option1']));
      $_tmp1 = \thrift\op\StringPatch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->option1 = $_tmp1;
    }
    if (idx($parsed, 'option2') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I32Patch>($parsed['option2']));
      $_tmp3 = \thrift\op\I32Patch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->option2 = $_tmp3;
    }
    if (idx($parsed, 'option3') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\InnerUnionPatch>($parsed['option3']));
      $_tmp5 = \fixtures\patch\InnerUnionPatch::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->option3 = $_tmp5;
    }
  }

}

/**
 * Original thrift struct:-
 * MyUnionPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyUnionPatch'))>>
class MyUnionPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnion::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnionFieldPatch::class,
    ),
    4 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnion::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnionFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 4,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\MyUnion,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\MyUnionFieldPatch,
    ?'ensure' => ?\fixtures\patch\MyUnion,
    ?'patch' => ?\fixtures\patch\MyUnionFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\MyUnion::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\MyUnionFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\MyUnion::TShape,
    ?'patch' => ?\fixtures\patch\MyUnionFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 4411333096338672350;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.MyUnion assign
   */
  public ?\fixtures\patch\MyUnion $assign;
  /**
   * Clears any set value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.MyUnionFieldPatch patchPrior
   */
  public ?\fixtures\patch\MyUnionFieldPatch $patchPrior;
  /**
   * Assigns the value, if not already set to the same field. Applies third.
   * 
   * Original thrift field:-
   * 4: struct module.MyUnion ensure
   */
  public ?\fixtures\patch\MyUnion $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.MyUnionFieldPatch patch
   */
  public ?\fixtures\patch\MyUnionFieldPatch $patch;

  public function __construct(?\fixtures\patch\MyUnion $assign = null, ?bool $clear = null, ?\fixtures\patch\MyUnionFieldPatch $patchPrior = null, ?\fixtures\patch\MyUnion $ensure = null, ?\fixtures\patch\MyUnionFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'MyUnionPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyUnionPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnion",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnionFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 4,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnion",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnionFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::UnionPatchAdapter",
            "underlyingName" => "MyUnionPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyUnionFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyUnionFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\MyUnion::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\MyUnionFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\MyUnion::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\MyUnionFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnion>($parsed['assign']));
      $_tmp1 = \fixtures\patch\MyUnion::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnionFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\MyUnionFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnion>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\MyUnion::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnionFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\MyUnionFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField10Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField10Patch'))>>
class MyStructField10Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::I32,
      'enum' => \fixtures\patch\MyEnum::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\MyEnum,
    ?'clear' => ?bool,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\MyEnum,
    'clear' => bool,
    ...
  );
  const int STRUCTURAL_ID = 1042349483945124076;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: enum module.MyEnum assign
   */
  public ?\fixtures\patch\MyEnum $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;

  public function __construct(?\fixtures\patch\MyEnum $assign = null, ?bool $clear = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField10Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField10Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_enum" => \tmeta_ThriftEnumType::fromShape(
                    shape(
                      "name" => "module.MyEnum",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
            "underlyingName" => "MyStructField10PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      $shape['clear'],
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign,
      'clear' => $this->clear,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $this->assign = \fixtures\patch\MyEnum::coerce(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyEnum>($parsed['assign']));
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField25Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField25Patch'))>>
class MyStructField25Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::I32,
      'enum' => \fixtures\patch\MyEnum::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\MyEnum,
    ?'clear' => ?bool,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\MyEnum,
    'clear' => bool,
    ...
  );
  const int STRUCTURAL_ID = 1042349483945124076;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: enum module.MyEnum assign
   */
  public ?\fixtures\patch\MyEnum $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;

  public function __construct(?\fixtures\patch\MyEnum $assign = null, ?bool $clear = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField25Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField25Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_enum" => \tmeta_ThriftEnumType::fromShape(
                    shape(
                      "name" => "module.MyEnum",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
            "underlyingName" => "MyStructField25PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      $shape['clear'],
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign,
      'clear' => $this->clear,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $this->assign = \fixtures\patch\MyEnum::coerce(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyEnum>($parsed['assign']));
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField28Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField28Patch'))>>
class MyStructField28Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::LST,
      'etype' => \TType::I16,
      'elem' => shape(
        'type' => \TType::I16,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::I32,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::I32,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\I16Patch::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::LST,
      'etype' => \TType::I16,
      'elem' => shape(
        'type' => \TType::I16,
      ),
      'format' => 'collection',
    ),
    8 => shape(
      'var' => 'prepend',
      'type' => \TType::LST,
      'etype' => \TType::I16,
      'elem' => shape(
        'type' => \TType::I16,
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'append',
      'type' => \TType::LST,
      'etype' => \TType::I16,
      'elem' => shape(
        'type' => \TType::I16,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patch' => 3,
    'remove' => 7,
    'prepend' => 8,
    'append' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Vector<int>,
    ?'clear' => ?bool,
    ?'patch' => ?Map<int, \thrift\op\I16Patch>,
    ?'remove' => ?Vector<int>,
    ?'prepend' => ?Vector<int>,
    ?'append' => ?Vector<int>,
  );

  const type TShape = shape(
    ?'assign' => ?vec<int>,
    'clear' => bool,
    'patch' => dict<int, \thrift\op\I16Patch::TShape>,
    'remove' => vec<int>,
    'prepend' => vec<int>,
    'append' => vec<int>,
    ...
  );
  const int STRUCTURAL_ID = 8909257665578209994;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: list<i16> assign
   */
  public ?Vector<int> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches list values by index. Applies second.
   * 
   * Original thrift field:-
   * 3: map<i32, struct patch.I16Patch> patch
   */
  public Map<int, \thrift\op\I16Patch> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: list<i16> remove
   */
  public Vector<int> $remove;
  /**
   * Prepends to the front of a given list.
   * 
   * Original thrift field:-
   * 8: list<i16> prepend
   */
  public Vector<int> $prepend;
  /**
   * Appends to the back of a given list.
   * 
   * Original thrift field:-
   * 9: list<i16> append
   */
  public Vector<int> $append;

  public function __construct(?Vector<int> $assign = null, ?bool $clear = null, ?Map<int, \thrift\op\I16Patch> $patch = null, ?Vector<int> $remove = null, ?Vector<int> $prepend = null, ?Vector<int> $append = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Vector {};
    $this->prepend = $prepend ?? Vector {};
    $this->append = $append ?? Vector {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'prepend'),
      Shapes::idx($shape, 'append'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField28Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField28Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.I16Patch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 8,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "prepend",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I16_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "append",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::ListPatchAdapter",
            "underlyingName" => "MyStructField28PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Vector($shape['assign']))),
      $shape['clear'],
      (new Map($shape['patch']))->map(
        $val0 ==> \thrift\op\I16Patch::__fromShape($val0),
      ),
      (new Vector($shape['remove'])),
      (new Vector($shape['prepend'])),
      (new Vector($shape['append'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign
        |> $$ === null ? null : vec($$),
      'clear' => $this->clear,
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => vec($this->remove),
      'prepend' => vec($this->prepend),
      'append' => vec($this->append),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Vector<int>>($parsed['assign']);
      $_container4 = Vector {};
      foreach($_json3 as $_key1 => $_value2) {
        $_elem5 = 0;
        $_tmp6 = (int)$_value2;
        if ($_tmp6 > 0x7fff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_elem5 = (int)$_tmp6;
        }
        $_container4 []= $_elem5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patch') !== null) {
      $_json10 = HH\FIXME\UNSAFE_CAST<mixed, Map<int, \thrift\op\I16Patch>>($parsed['patch']);
      $_container11 = Map {};
      foreach($_json10 as $_key8 => $_value9) {
        $_value12 = \thrift\op\I16Patch::withDefaultValues();
        $_tmp13 = \json_encode($_value9);
        $_tmp14 = \thrift\op\I16Patch::withDefaultValues();
        $_tmp14->readFromJson($_tmp13);
        $_value12 = $_tmp14;
        $_container11[$_key8] = $_value12;
      }
      $this->patch = $_container11;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json18 = HH\FIXME\UNSAFE_CAST<mixed, Vector<int>>($parsed['remove']);
      $_container19 = Vector {};
      foreach($_json18 as $_key16 => $_value17) {
        $_elem20 = 0;
        $_tmp21 = (int)$_value17;
        if ($_tmp21 > 0x7fff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_elem20 = (int)$_tmp21;
        }
        $_container19 []= $_elem20;
      }
      $this->remove = $_container19;
    }
    if (idx($parsed, 'prepend') !== null) {
      $_json25 = HH\FIXME\UNSAFE_CAST<mixed, Vector<int>>($parsed['prepend']);
      $_container26 = Vector {};
      foreach($_json25 as $_key23 => $_value24) {
        $_elem27 = 0;
        $_tmp28 = (int)$_value24;
        if ($_tmp28 > 0x7fff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_elem27 = (int)$_tmp28;
        }
        $_container26 []= $_elem27;
      }
      $this->prepend = $_container26;
    }
    if (idx($parsed, 'append') !== null) {
      $_json32 = HH\FIXME\UNSAFE_CAST<mixed, Vector<int>>($parsed['append']);
      $_container33 = Vector {};
      foreach($_json32 as $_key30 => $_value31) {
        $_elem34 = 0;
        $_tmp35 = (int)$_value31;
        if ($_tmp35 > 0x7fff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_elem34 = (int)$_tmp35;
        }
        $_container33 []= $_elem34;
      }
      $this->append = $_container33;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField29Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField29Patch'))>>
class MyStructField29Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    8 => shape(
      'var' => 'add',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'remove' => 7,
    'add' => 8,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Set<string>,
    ?'clear' => ?bool,
    ?'remove' => ?Set<string>,
    ?'add' => ?Set<string>,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, bool>,
    'clear' => bool,
    'remove' => dict<string, bool>,
    'add' => dict<string, bool>,
    ...
  );
  const int STRUCTURAL_ID = 5127750308738770244;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: set<string> assign
   */
  public ?Set<string> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: set<string> remove
   */
  public Set<string> $remove;
  /**
   * Adds entries, if not already present. Applies fourth.
   * 
   * Original thrift field:-
   * 8: set<string> add
   */
  public Set<string> $add;

  public function __construct(?Set<string> $assign = null, ?bool $clear = null, ?Set<string> $remove = null, ?Set<string> $add = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->remove = $remove ?? Set {};
    $this->add = $add ?? Set {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'add'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField29Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField29Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 8,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "add",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::SetPatchAdapter",
            "underlyingName" => "MyStructField29PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (new Set(Keyset\keys($shape['assign']))),
      $shape['clear'],
      new Set(Keyset\keys($shape['remove'])),
      new Set(Keyset\keys($shape['add'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign
        |> $$ === null ? null : ThriftUtil::toDArray(Dict\fill_keys($$->toValuesArray(), true), static::class),
      'clear' => $this->clear,
      'remove' => ThriftUtil::toDArray(Dict\fill_keys($this->remove->toValuesArray(), true), static::class),
      'add' => ThriftUtil::toDArray(Dict\fill_keys($this->add->toValuesArray(), true), static::class),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['assign']);
      $_container4 = Set {};
      foreach($_json3 as $_key1 => $_value2) {
        $_elem5 = '';
        $_elem5 = $_value2;
        $_container4->add($_elem5);
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'remove') !== null) {
      $_json9 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['remove']);
      $_container10 = Set {};
      foreach($_json9 as $_key7 => $_value8) {
        $_elem11 = '';
        $_elem11 = $_value8;
        $_container10->add($_elem11);
      }
      $this->remove = $_container10;
    }
    if (idx($parsed, 'add') !== null) {
      $_json15 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['add']);
      $_container16 = Set {};
      foreach($_json15 as $_key13 => $_value14) {
        $_elem17 = '';
        $_elem17 = $_value14;
        $_container16->add($_elem17);
      }
      $this->add = $_container16;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField30Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField30Patch'))>>
class MyStructField30Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRING,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\StringPatch::class,
      ),
      'format' => 'collection',
    ),
    5 => shape(
      'var' => 'add',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRING,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\StringPatch::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'put',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRING,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'add' => 5,
    'patch' => 6,
    'remove' => 7,
    'put' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Map<string, string>,
    ?'clear' => ?bool,
    ?'patchPrior' => ?Map<string, \thrift\op\StringPatch>,
    ?'add' => ?Map<string, string>,
    ?'patch' => ?Map<string, \thrift\op\StringPatch>,
    ?'remove' => ?Set<string>,
    ?'put' => ?Map<string, string>,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, string>,
    'clear' => bool,
    'patchPrior' => dict<string, \thrift\op\StringPatch::TShape>,
    'add' => dict<string, string>,
    'patch' => dict<string, \thrift\op\StringPatch::TShape>,
    'remove' => dict<string, bool>,
    'put' => dict<string, string>,
    ...
  );
  const int STRUCTURAL_ID = 7038176317813649650;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: map<string, string> assign
   */
  public ?Map<string, string> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: map<string, struct patch.StringPatch> patchPrior
   */
  public Map<string, \thrift\op\StringPatch> $patchPrior;
  /**
   * Add the given values, if the keys are not already present. Applies forth.
   * 
   * Original thrift field:-
   * 5: map<string, string> add
   */
  public Map<string, string> $add;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: map<string, struct patch.StringPatch> patch
   */
  public Map<string, \thrift\op\StringPatch> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: set<string> remove
   */
  public Set<string> $remove;
  /**
   * Adds or replaces the given key/value pairs. Applies fifth.
   * 
   * Original thrift field:-
   * 9: map<string, string> put
   */
  public Map<string, string> $put;

  public function __construct(?Map<string, string> $assign = null, ?bool $clear = null, ?Map<string, \thrift\op\StringPatch> $patchPrior = null, ?Map<string, string> $add = null, ?Map<string, \thrift\op\StringPatch> $patch = null, ?Set<string> $remove = null, ?Map<string, string> $put = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior ?? Map {};
    $this->add = $add ?? Map {};
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Set {};
    $this->put = $put ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'add'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'put'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField30Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField30Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.StringPatch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "add",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.StringPatch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "put",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::MapPatchAdapter",
            "underlyingName" => "MyStructField30PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Map($shape['assign']))),
      $shape['clear'],
      (new Map($shape['patchPrior']))->map(
        $val0 ==> \thrift\op\StringPatch::__fromShape($val0),
      ),
      (new Map($shape['add'])),
      (new Map($shape['patch']))->map(
        $val1 ==> \thrift\op\StringPatch::__fromShape($val1),
      ),
      new Set(Keyset\keys($shape['remove'])),
      (new Map($shape['put'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign
        |> $$ === null ? null : dict($$),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'add' => dict($this->add),
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => ThriftUtil::toDArray(Dict\fill_keys($this->remove->toValuesArray(), true), static::class),
      'put' => dict($this->put),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, string>>($parsed['assign']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = '';
        $_value5 = $_value2;
        $_container4[$_key1] = $_value5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_json9 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\StringPatch>>($parsed['patchPrior']);
      $_container10 = Map {};
      foreach($_json9 as $_key7 => $_value8) {
        $_value11 = \thrift\op\StringPatch::withDefaultValues();
        $_tmp12 = \json_encode($_value8);
        $_tmp13 = \thrift\op\StringPatch::withDefaultValues();
        $_tmp13->readFromJson($_tmp12);
        $_value11 = $_tmp13;
        $_container10[$_key7] = $_value11;
      }
      $this->patchPrior = $_container10;
    }
    if (idx($parsed, 'add') !== null) {
      $_json17 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, string>>($parsed['add']);
      $_container18 = Map {};
      foreach($_json17 as $_key15 => $_value16) {
        $_value19 = '';
        $_value19 = $_value16;
        $_container18[$_key15] = $_value19;
      }
      $this->add = $_container18;
    }
    if (idx($parsed, 'patch') !== null) {
      $_json23 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\StringPatch>>($parsed['patch']);
      $_container24 = Map {};
      foreach($_json23 as $_key21 => $_value22) {
        $_value25 = \thrift\op\StringPatch::withDefaultValues();
        $_tmp26 = \json_encode($_value22);
        $_tmp27 = \thrift\op\StringPatch::withDefaultValues();
        $_tmp27->readFromJson($_tmp26);
        $_value25 = $_tmp27;
        $_container24[$_key21] = $_value25;
      }
      $this->patch = $_container24;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json31 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['remove']);
      $_container32 = Set {};
      foreach($_json31 as $_key29 => $_value30) {
        $_elem33 = '';
        $_elem33 = $_value30;
        $_container32->add($_elem33);
      }
      $this->remove = $_container32;
    }
    if (idx($parsed, 'put') !== null) {
      $_json37 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, string>>($parsed['put']);
      $_container38 = Map {};
      foreach($_json37 as $_key35 => $_value36) {
        $_value39 = '';
        $_value39 = $_value36;
        $_container38[$_key35] = $_value39;
      }
      $this->put = $_container38;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField31Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField31Patch'))>>
class MyStructField31Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::LST,
      'etype' => \TType::MAP,
      'elem' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::I32,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::I32,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \fixtures\patch\MyStructField31Patch1::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::LST,
      'etype' => \TType::MAP,
      'elem' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    8 => shape(
      'var' => 'prepend',
      'type' => \TType::LST,
      'etype' => \TType::MAP,
      'elem' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'append',
      'type' => \TType::LST,
      'etype' => \TType::MAP,
      'elem' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patch' => 3,
    'remove' => 7,
    'prepend' => 8,
    'append' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Vector<Map<string, int>>,
    ?'clear' => ?bool,
    ?'patch' => ?Map<int, \fixtures\patch\MyStructField31Patch1>,
    ?'remove' => ?Vector<Map<string, int>>,
    ?'prepend' => ?Vector<Map<string, int>>,
    ?'append' => ?Vector<Map<string, int>>,
  );

  const type TShape = shape(
    ?'assign' => ?vec<dict<string, int>>,
    'clear' => bool,
    'patch' => dict<int, \fixtures\patch\MyStructField31Patch1::TShape>,
    'remove' => vec<dict<string, int>>,
    'prepend' => vec<dict<string, int>>,
    'append' => vec<dict<string, int>>,
    ...
  );
  const int STRUCTURAL_ID = 8909257665578209994;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: list<map<string, i32>> assign
   */
  public ?Vector<Map<string, int>> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches list values by index. Applies second.
   * 
   * Original thrift field:-
   * 3: map<i32, struct module.MyStructField31Patch1> patch
   */
  public Map<int, \fixtures\patch\MyStructField31Patch1> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: list<map<string, i32>> remove
   */
  public Vector<Map<string, int>> $remove;
  /**
   * Prepends to the front of a given list.
   * 
   * Original thrift field:-
   * 8: list<map<string, i32>> prepend
   */
  public Vector<Map<string, int>> $prepend;
  /**
   * Appends to the back of a given list.
   * 
   * Original thrift field:-
   * 9: list<map<string, i32>> append
   */
  public Vector<Map<string, int>> $append;

  public function __construct(?Vector<Map<string, int>> $assign = null, ?bool $clear = null, ?Map<int, \fixtures\patch\MyStructField31Patch1> $patch = null, ?Vector<Map<string, int>> $remove = null, ?Vector<Map<string, int>> $prepend = null, ?Vector<Map<string, int>> $append = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Vector {};
    $this->prepend = $prepend ?? Vector {};
    $this->append = $append ?? Vector {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'prepend'),
      Shapes::idx($shape, 'append'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField31Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField31Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.MyStructField31Patch1",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 8,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "prepend",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_list" => \tmeta_ThriftListType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "append",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::ListPatchAdapter",
            "underlyingName" => "MyStructField31PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Vector($shape['assign']))->map(
        $val0 ==> (new Map($val0)),
      )),
      $shape['clear'],
      (new Map($shape['patch']))->map(
        $val1 ==> \fixtures\patch\MyStructField31Patch1::__fromShape($val1),
      ),
      (new Vector($shape['remove']))->map(
        $val2 ==> (new Map($val2)),
      ),
      (new Vector($shape['prepend']))->map(
        $val3 ==> (new Map($val3)),
      ),
      (new Vector($shape['append']))->map(
        $val4 ==> (new Map($val4)),
      ),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->map(
        ($_val0) ==> dict($_val0),
      )
        |> $$ === null ? null : vec($$),
      'clear' => $this->clear,
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => $this->remove->map(
        ($_val0) ==> dict($_val0),
      )
        |> vec($$),
      'prepend' => $this->prepend->map(
        ($_val0) ==> dict($_val0),
      )
        |> vec($$),
      'append' => $this->append->map(
        ($_val0) ==> dict($_val0),
      )
        |> vec($$),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Vector<Map<string, int>>>($parsed['assign']);
      $_container4 = Vector {};
      foreach($_json3 as $_key1 => $_value2) {
        $_elem5 = Map {};
        $_json9 = $_value2;
        $_container10 = Map {};
        foreach($_json9 as $_key7 => $_value8) {
          $_value11 = 0;
          $_tmp12 = (int)$_value8;
          if ($_tmp12 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value11 = (int)$_tmp12;
          }
          $_container10[$_key7] = $_value11;
        }
        $_elem5 = $_container10;
        $_container4 []= $_elem5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patch') !== null) {
      $_json16 = HH\FIXME\UNSAFE_CAST<mixed, Map<int, \fixtures\patch\MyStructField31Patch1>>($parsed['patch']);
      $_container17 = Map {};
      foreach($_json16 as $_key14 => $_value15) {
        $_value18 = \fixtures\patch\MyStructField31Patch1::withDefaultValues();
        $_tmp19 = \json_encode($_value15);
        $_tmp20 = \fixtures\patch\MyStructField31Patch1::withDefaultValues();
        $_tmp20->readFromJson($_tmp19);
        $_value18 = $_tmp20;
        $_container17[$_key14] = $_value18;
      }
      $this->patch = $_container17;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json24 = HH\FIXME\UNSAFE_CAST<mixed, Vector<Map<string, int>>>($parsed['remove']);
      $_container25 = Vector {};
      foreach($_json24 as $_key22 => $_value23) {
        $_elem26 = Map {};
        $_json30 = $_value23;
        $_container31 = Map {};
        foreach($_json30 as $_key28 => $_value29) {
          $_value32 = 0;
          $_tmp33 = (int)$_value29;
          if ($_tmp33 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value32 = (int)$_tmp33;
          }
          $_container31[$_key28] = $_value32;
        }
        $_elem26 = $_container31;
        $_container25 []= $_elem26;
      }
      $this->remove = $_container25;
    }
    if (idx($parsed, 'prepend') !== null) {
      $_json37 = HH\FIXME\UNSAFE_CAST<mixed, Vector<Map<string, int>>>($parsed['prepend']);
      $_container38 = Vector {};
      foreach($_json37 as $_key35 => $_value36) {
        $_elem39 = Map {};
        $_json43 = $_value36;
        $_container44 = Map {};
        foreach($_json43 as $_key41 => $_value42) {
          $_value45 = 0;
          $_tmp46 = (int)$_value42;
          if ($_tmp46 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value45 = (int)$_tmp46;
          }
          $_container44[$_key41] = $_value45;
        }
        $_elem39 = $_container44;
        $_container38 []= $_elem39;
      }
      $this->prepend = $_container38;
    }
    if (idx($parsed, 'append') !== null) {
      $_json50 = HH\FIXME\UNSAFE_CAST<mixed, Vector<Map<string, int>>>($parsed['append']);
      $_container51 = Vector {};
      foreach($_json50 as $_key48 => $_value49) {
        $_elem52 = Map {};
        $_json56 = $_value49;
        $_container57 = Map {};
        foreach($_json56 as $_key54 => $_value55) {
          $_value58 = 0;
          $_tmp59 = (int)$_value55;
          if ($_tmp59 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value58 = (int)$_tmp59;
          }
          $_container57[$_key54] = $_value58;
        }
        $_elem52 = $_container57;
        $_container51 []= $_elem52;
      }
      $this->append = $_container51;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField31Patch1
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField31Patch1'))>>
class MyStructField31Patch1 implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\I32Patch::class,
      ),
      'format' => 'collection',
    ),
    5 => shape(
      'var' => 'add',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\I32Patch::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'put',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'add' => 5,
    'patch' => 6,
    'remove' => 7,
    'put' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Map<string, int>,
    ?'clear' => ?bool,
    ?'patchPrior' => ?Map<string, \thrift\op\I32Patch>,
    ?'add' => ?Map<string, int>,
    ?'patch' => ?Map<string, \thrift\op\I32Patch>,
    ?'remove' => ?Set<string>,
    ?'put' => ?Map<string, int>,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, int>,
    'clear' => bool,
    'patchPrior' => dict<string, \thrift\op\I32Patch::TShape>,
    'add' => dict<string, int>,
    'patch' => dict<string, \thrift\op\I32Patch::TShape>,
    'remove' => dict<string, bool>,
    'put' => dict<string, int>,
    ...
  );
  const int STRUCTURAL_ID = 7038176317813649650;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: map<string, i32> assign
   */
  public ?Map<string, int> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: map<string, struct patch.I32Patch> patchPrior
   */
  public Map<string, \thrift\op\I32Patch> $patchPrior;
  /**
   * Add the given values, if the keys are not already present. Applies forth.
   * 
   * Original thrift field:-
   * 5: map<string, i32> add
   */
  public Map<string, int> $add;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: map<string, struct patch.I32Patch> patch
   */
  public Map<string, \thrift\op\I32Patch> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: set<string> remove
   */
  public Set<string> $remove;
  /**
   * Adds or replaces the given key/value pairs. Applies fifth.
   * 
   * Original thrift field:-
   * 9: map<string, i32> put
   */
  public Map<string, int> $put;

  public function __construct(?Map<string, int> $assign = null, ?bool $clear = null, ?Map<string, \thrift\op\I32Patch> $patchPrior = null, ?Map<string, int> $add = null, ?Map<string, \thrift\op\I32Patch> $patch = null, ?Set<string> $remove = null, ?Map<string, int> $put = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior ?? Map {};
    $this->add = $add ?? Map {};
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Set {};
    $this->put = $put ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'add'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'put'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField31Patch1';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField31Patch1",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.I32Patch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "add",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.I32Patch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "put",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::MapPatchAdapter",
            "underlyingName" => "MyStructField31Patch1Struct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Map($shape['assign']))),
      $shape['clear'],
      (new Map($shape['patchPrior']))->map(
        $val0 ==> \thrift\op\I32Patch::__fromShape($val0),
      ),
      (new Map($shape['add'])),
      (new Map($shape['patch']))->map(
        $val1 ==> \thrift\op\I32Patch::__fromShape($val1),
      ),
      new Set(Keyset\keys($shape['remove'])),
      (new Map($shape['put'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign
        |> $$ === null ? null : dict($$),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'add' => dict($this->add),
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => ThriftUtil::toDArray(Dict\fill_keys($this->remove->toValuesArray(), true), static::class),
      'put' => dict($this->put),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['assign']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = 0;
        $_tmp6 = (int)$_value2;
        if ($_tmp6 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value5 = (int)$_tmp6;
        }
        $_container4[$_key1] = $_value5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_json10 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\I32Patch>>($parsed['patchPrior']);
      $_container11 = Map {};
      foreach($_json10 as $_key8 => $_value9) {
        $_value12 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp13 = \json_encode($_value9);
        $_tmp14 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp14->readFromJson($_tmp13);
        $_value12 = $_tmp14;
        $_container11[$_key8] = $_value12;
      }
      $this->patchPrior = $_container11;
    }
    if (idx($parsed, 'add') !== null) {
      $_json18 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['add']);
      $_container19 = Map {};
      foreach($_json18 as $_key16 => $_value17) {
        $_value20 = 0;
        $_tmp21 = (int)$_value17;
        if ($_tmp21 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value20 = (int)$_tmp21;
        }
        $_container19[$_key16] = $_value20;
      }
      $this->add = $_container19;
    }
    if (idx($parsed, 'patch') !== null) {
      $_json25 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\I32Patch>>($parsed['patch']);
      $_container26 = Map {};
      foreach($_json25 as $_key23 => $_value24) {
        $_value27 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp28 = \json_encode($_value24);
        $_tmp29 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp29->readFromJson($_tmp28);
        $_value27 = $_tmp29;
        $_container26[$_key23] = $_value27;
      }
      $this->patch = $_container26;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json33 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['remove']);
      $_container34 = Set {};
      foreach($_json33 as $_key31 => $_value32) {
        $_elem35 = '';
        $_elem35 = $_value32;
        $_container34->add($_elem35);
      }
      $this->remove = $_container34;
    }
    if (idx($parsed, 'put') !== null) {
      $_json39 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['put']);
      $_container40 = Map {};
      foreach($_json39 as $_key37 => $_value38) {
        $_value41 = 0;
        $_tmp42 = (int)$_value38;
        if ($_tmp42 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value41 = (int)$_tmp42;
        }
        $_container40[$_key37] = $_value41;
      }
      $this->put = $_container40;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField32Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField32Patch'))>>
class MyStructField32Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::MAP,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \fixtures\patch\MyStructField32Patch1::class,
      ),
      'format' => 'collection',
    ),
    5 => shape(
      'var' => 'add',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::MAP,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \fixtures\patch\MyStructField32Patch1::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'put',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::MAP,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::MAP,
        'ktype' => \TType::STRING,
        'vtype' => \TType::I32,
        'key' => shape(
          'type' => \TType::STRING,
        ),
        'val' => shape(
          'type' => \TType::I32,
        ),
        'format' => 'collection',
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'add' => 5,
    'patch' => 6,
    'remove' => 7,
    'put' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Map<string, Map<string, int>>,
    ?'clear' => ?bool,
    ?'patchPrior' => ?Map<string, \fixtures\patch\MyStructField32Patch1>,
    ?'add' => ?Map<string, Map<string, int>>,
    ?'patch' => ?Map<string, \fixtures\patch\MyStructField32Patch1>,
    ?'remove' => ?Set<string>,
    ?'put' => ?Map<string, Map<string, int>>,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, dict<string, int>>,
    'clear' => bool,
    'patchPrior' => dict<string, \fixtures\patch\MyStructField32Patch1::TShape>,
    'add' => dict<string, dict<string, int>>,
    'patch' => dict<string, \fixtures\patch\MyStructField32Patch1::TShape>,
    'remove' => dict<string, bool>,
    'put' => dict<string, dict<string, int>>,
    ...
  );
  const int STRUCTURAL_ID = 7038176317813649650;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: map<string, map<string, i32>> assign
   */
  public ?Map<string, Map<string, int>> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: map<string, struct module.MyStructField32Patch1> patchPrior
   */
  public Map<string, \fixtures\patch\MyStructField32Patch1> $patchPrior;
  /**
   * Add the given values, if the keys are not already present. Applies forth.
   * 
   * Original thrift field:-
   * 5: map<string, map<string, i32>> add
   */
  public Map<string, Map<string, int>> $add;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: map<string, struct module.MyStructField32Patch1> patch
   */
  public Map<string, \fixtures\patch\MyStructField32Patch1> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: set<string> remove
   */
  public Set<string> $remove;
  /**
   * Adds or replaces the given key/value pairs. Applies fifth.
   * 
   * Original thrift field:-
   * 9: map<string, map<string, i32>> put
   */
  public Map<string, Map<string, int>> $put;

  public function __construct(?Map<string, Map<string, int>> $assign = null, ?bool $clear = null, ?Map<string, \fixtures\patch\MyStructField32Patch1> $patchPrior = null, ?Map<string, Map<string, int>> $add = null, ?Map<string, \fixtures\patch\MyStructField32Patch1> $patch = null, ?Set<string> $remove = null, ?Map<string, Map<string, int>> $put = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior ?? Map {};
    $this->add = $add ?? Map {};
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Set {};
    $this->put = $put ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'add'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'put'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField32Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField32Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.MyStructField32Patch1",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "add",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.MyStructField32Patch1",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_map" => \tmeta_ThriftMapType::fromShape(
                            shape(
                              "keyType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                                )
                              ),
                              "valueType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "put",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::MapPatchAdapter",
            "underlyingName" => "MyStructField32PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Map($shape['assign']))->map(
        $val0 ==> (new Map($val0)),
      )),
      $shape['clear'],
      (new Map($shape['patchPrior']))->map(
        $val1 ==> \fixtures\patch\MyStructField32Patch1::__fromShape($val1),
      ),
      (new Map($shape['add']))->map(
        $val2 ==> (new Map($val2)),
      ),
      (new Map($shape['patch']))->map(
        $val3 ==> \fixtures\patch\MyStructField32Patch1::__fromShape($val3),
      ),
      new Set(Keyset\keys($shape['remove'])),
      (new Map($shape['put']))->map(
        $val4 ==> (new Map($val4)),
      ),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->map(
        ($_val0) ==> dict($_val0),
      )
        |> $$ === null ? null : dict($$),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'add' => $this->add->map(
        ($_val0) ==> dict($_val0),
      )
        |> dict($$),
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => ThriftUtil::toDArray(Dict\fill_keys($this->remove->toValuesArray(), true), static::class),
      'put' => $this->put->map(
        ($_val0) ==> dict($_val0),
      )
        |> dict($$),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, Map<string, int>>>($parsed['assign']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = Map {};
        $_json9 = $_value2;
        $_container10 = Map {};
        foreach($_json9 as $_key7 => $_value8) {
          $_value11 = 0;
          $_tmp12 = (int)$_value8;
          if ($_tmp12 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value11 = (int)$_tmp12;
          }
          $_container10[$_key7] = $_value11;
        }
        $_value5 = $_container10;
        $_container4[$_key1] = $_value5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_json16 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \fixtures\patch\MyStructField32Patch1>>($parsed['patchPrior']);
      $_container17 = Map {};
      foreach($_json16 as $_key14 => $_value15) {
        $_value18 = \fixtures\patch\MyStructField32Patch1::withDefaultValues();
        $_tmp19 = \json_encode($_value15);
        $_tmp20 = \fixtures\patch\MyStructField32Patch1::withDefaultValues();
        $_tmp20->readFromJson($_tmp19);
        $_value18 = $_tmp20;
        $_container17[$_key14] = $_value18;
      }
      $this->patchPrior = $_container17;
    }
    if (idx($parsed, 'add') !== null) {
      $_json24 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, Map<string, int>>>($parsed['add']);
      $_container25 = Map {};
      foreach($_json24 as $_key22 => $_value23) {
        $_value26 = Map {};
        $_json30 = $_value23;
        $_container31 = Map {};
        foreach($_json30 as $_key28 => $_value29) {
          $_value32 = 0;
          $_tmp33 = (int)$_value29;
          if ($_tmp33 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value32 = (int)$_tmp33;
          }
          $_container31[$_key28] = $_value32;
        }
        $_value26 = $_container31;
        $_container25[$_key22] = $_value26;
      }
      $this->add = $_container25;
    }
    if (idx($parsed, 'patch') !== null) {
      $_json37 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \fixtures\patch\MyStructField32Patch1>>($parsed['patch']);
      $_container38 = Map {};
      foreach($_json37 as $_key35 => $_value36) {
        $_value39 = \fixtures\patch\MyStructField32Patch1::withDefaultValues();
        $_tmp40 = \json_encode($_value36);
        $_tmp41 = \fixtures\patch\MyStructField32Patch1::withDefaultValues();
        $_tmp41->readFromJson($_tmp40);
        $_value39 = $_tmp41;
        $_container38[$_key35] = $_value39;
      }
      $this->patch = $_container38;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json45 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['remove']);
      $_container46 = Set {};
      foreach($_json45 as $_key43 => $_value44) {
        $_elem47 = '';
        $_elem47 = $_value44;
        $_container46->add($_elem47);
      }
      $this->remove = $_container46;
    }
    if (idx($parsed, 'put') !== null) {
      $_json51 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, Map<string, int>>>($parsed['put']);
      $_container52 = Map {};
      foreach($_json51 as $_key49 => $_value50) {
        $_value53 = Map {};
        $_json57 = $_value50;
        $_container58 = Map {};
        foreach($_json57 as $_key55 => $_value56) {
          $_value59 = 0;
          $_tmp60 = (int)$_value56;
          if ($_tmp60 > 0x7fffffff) {
            throw new \TProtocolException("number exceeds limit in field");
          } else {
            $_value59 = (int)$_tmp60;
          }
          $_container58[$_key55] = $_value59;
        }
        $_value53 = $_container58;
        $_container52[$_key49] = $_value53;
      }
      $this->put = $_container52;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructField32Patch1
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructField32Patch1'))>>
class MyStructField32Patch1 implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\I32Patch::class,
      ),
      'format' => 'collection',
    ),
    5 => shape(
      'var' => 'add',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \thrift\op\I32Patch::class,
      ),
      'format' => 'collection',
    ),
    7 => shape(
      'var' => 'remove',
      'type' => \TType::SET,
      'etype' => \TType::STRING,
      'elem' => shape(
        'type' => \TType::STRING,
      ),
      'format' => 'collection',
    ),
    9 => shape(
      'var' => 'put',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::I32,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::I32,
      ),
      'format' => 'collection',
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'add' => 5,
    'patch' => 6,
    'remove' => 7,
    'put' => 9,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Map<string, int>,
    ?'clear' => ?bool,
    ?'patchPrior' => ?Map<string, \thrift\op\I32Patch>,
    ?'add' => ?Map<string, int>,
    ?'patch' => ?Map<string, \thrift\op\I32Patch>,
    ?'remove' => ?Set<string>,
    ?'put' => ?Map<string, int>,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, int>,
    'clear' => bool,
    'patchPrior' => dict<string, \thrift\op\I32Patch::TShape>,
    'add' => dict<string, int>,
    'patch' => dict<string, \thrift\op\I32Patch::TShape>,
    'remove' => dict<string, bool>,
    'put' => dict<string, int>,
    ...
  );
  const int STRUCTURAL_ID = 7038176317813649650;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: map<string, i32> assign
   */
  public ?Map<string, int> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: map<string, struct patch.I32Patch> patchPrior
   */
  public Map<string, \thrift\op\I32Patch> $patchPrior;
  /**
   * Add the given values, if the keys are not already present. Applies forth.
   * 
   * Original thrift field:-
   * 5: map<string, i32> add
   */
  public Map<string, int> $add;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: map<string, struct patch.I32Patch> patch
   */
  public Map<string, \thrift\op\I32Patch> $patch;
  /**
   * Removes entries, if present. Applies third.
   * 
   * Original thrift field:-
   * 7: set<string> remove
   */
  public Set<string> $remove;
  /**
   * Adds or replaces the given key/value pairs. Applies fifth.
   * 
   * Original thrift field:-
   * 9: map<string, i32> put
   */
  public Map<string, int> $put;

  public function __construct(?Map<string, int> $assign = null, ?bool $clear = null, ?Map<string, \thrift\op\I32Patch> $patchPrior = null, ?Map<string, int> $add = null, ?Map<string, \thrift\op\I32Patch> $patch = null, ?Set<string> $remove = null, ?Map<string, int> $put = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior ?? Map {};
    $this->add = $add ?? Map {};
    $this->patch = $patch ?? Map {};
    $this->remove = $remove ?? Set {};
    $this->put = $put ?? Map {};
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'add'),
      Shapes::idx($shape, 'patch'),
      Shapes::idx($shape, 'remove'),
      Shapes::idx($shape, 'put'),
    );
  }

  public function getName()[]: string {
    return 'MyStructField32Patch1';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructField32Patch1",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.I32Patch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "add",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "patch.I32Patch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_set" => \tmeta_ThriftSetType::fromShape(
                    shape(
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "remove",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_I32_TYPE,
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "put",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::MapPatchAdapter",
            "underlyingName" => "MyStructField32Patch1Struct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Map($shape['assign']))),
      $shape['clear'],
      (new Map($shape['patchPrior']))->map(
        $val0 ==> \thrift\op\I32Patch::__fromShape($val0),
      ),
      (new Map($shape['add'])),
      (new Map($shape['patch']))->map(
        $val1 ==> \thrift\op\I32Patch::__fromShape($val1),
      ),
      new Set(Keyset\keys($shape['remove'])),
      (new Map($shape['put'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign
        |> $$ === null ? null : dict($$),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'add' => dict($this->add),
      'patch' => $this->patch->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> dict($$),
      'remove' => ThriftUtil::toDArray(Dict\fill_keys($this->remove->toValuesArray(), true), static::class),
      'put' => dict($this->put),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['assign']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = 0;
        $_tmp6 = (int)$_value2;
        if ($_tmp6 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value5 = (int)$_tmp6;
        }
        $_container4[$_key1] = $_value5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_json10 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\I32Patch>>($parsed['patchPrior']);
      $_container11 = Map {};
      foreach($_json10 as $_key8 => $_value9) {
        $_value12 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp13 = \json_encode($_value9);
        $_tmp14 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp14->readFromJson($_tmp13);
        $_value12 = $_tmp14;
        $_container11[$_key8] = $_value12;
      }
      $this->patchPrior = $_container11;
    }
    if (idx($parsed, 'add') !== null) {
      $_json18 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['add']);
      $_container19 = Map {};
      foreach($_json18 as $_key16 => $_value17) {
        $_value20 = 0;
        $_tmp21 = (int)$_value17;
        if ($_tmp21 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value20 = (int)$_tmp21;
        }
        $_container19[$_key16] = $_value20;
      }
      $this->add = $_container19;
    }
    if (idx($parsed, 'patch') !== null) {
      $_json25 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \thrift\op\I32Patch>>($parsed['patch']);
      $_container26 = Map {};
      foreach($_json25 as $_key23 => $_value24) {
        $_value27 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp28 = \json_encode($_value24);
        $_tmp29 = \thrift\op\I32Patch::withDefaultValues();
        $_tmp29->readFromJson($_tmp28);
        $_value27 = $_tmp29;
        $_container26[$_key23] = $_value27;
      }
      $this->patch = $_container26;
    }
    if (idx($parsed, 'remove') !== null) {
      $_json33 = HH\FIXME\UNSAFE_CAST<mixed, Set<string>>($parsed['remove']);
      $_container34 = Set {};
      foreach($_json33 as $_key31 => $_value32) {
        $_elem35 = '';
        $_elem35 = $_value32;
        $_container34->add($_elem35);
      }
      $this->remove = $_container34;
    }
    if (idx($parsed, 'put') !== null) {
      $_json39 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, int>>($parsed['put']);
      $_container40 = Map {};
      foreach($_json39 as $_key37 => $_value38) {
        $_value41 = 0;
        $_tmp42 = (int)$_value38;
        if ($_tmp42 > 0x7fffffff) {
          throw new \TProtocolException("number exceeds limit in field");
        } else {
          $_value41 = (int)$_tmp42;
        }
        $_container40[$_key37] = $_value41;
      }
      $this->put = $_container40;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructFieldPatch'))>>
class MyStructFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -32 => shape(
      'var' => 'mapMap',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField32Patch::class,
    ),
    -31 => shape(
      'var' => 'listMap',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField31Patch::class,
    ),
    -30 => shape(
      'var' => 'optMapVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField30Patch::class,
    ),
    -29 => shape(
      'var' => 'optSetVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField29Patch::class,
    ),
    -28 => shape(
      'var' => 'optListVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField28Patch::class,
    ),
    -27 => shape(
      'var' => 'optLateStructVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStructPatch::class,
    ),
    -26 => shape(
      'var' => 'optStructVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyDataPatch::class,
    ),
    -25 => shape(
      'var' => 'optEnumVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField25Patch::class,
    ),
    -24 => shape(
      'var' => 'optBinaryVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BinaryPatch::class,
    ),
    -23 => shape(
      'var' => 'optStringVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\StringPatch::class,
    ),
    -22 => shape(
      'var' => 'optDoubleVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\DoublePatch::class,
    ),
    -21 => shape(
      'var' => 'optFloatVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\FloatPatch::class,
    ),
    -20 => shape(
      'var' => 'optI64Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I64Patch::class,
    ),
    -19 => shape(
      'var' => 'optI32Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I32Patch::class,
    ),
    -18 => shape(
      'var' => 'optI16Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I16Patch::class,
    ),
    -17 => shape(
      'var' => 'optByteVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BytePatch::class,
    ),
    -16 => shape(
      'var' => 'optBoolVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BoolPatch::class,
    ),
    -15 => shape(
      'var' => 'timeVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\TimePatch::class,
    ),
    -14 => shape(
      'var' => 'durationVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\DurationPatch::class,
    ),
    -13 => shape(
      'var' => 'lateStructVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStructPatch::class,
    ),
    -12 => shape(
      'var' => 'unionVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyUnionPatch::class,
    ),
    -11 => shape(
      'var' => 'structVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyDataPatch::class,
    ),
    -10 => shape(
      'var' => 'enumVal',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructField10Patch::class,
    ),
    -9 => shape(
      'var' => 'binaryVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BinaryPatch::class,
    ),
    -8 => shape(
      'var' => 'stringVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\StringPatch::class,
    ),
    -7 => shape(
      'var' => 'doubleVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\DoublePatch::class,
    ),
    -6 => shape(
      'var' => 'floatVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\FloatPatch::class,
    ),
    -5 => shape(
      'var' => 'i64Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I64Patch::class,
    ),
    -4 => shape(
      'var' => 'i32Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I32Patch::class,
    ),
    -3 => shape(
      'var' => 'i16Val',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\I16Patch::class,
    ),
    -2 => shape(
      'var' => 'byteVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BytePatch::class,
    ),
    -1 => shape(
      'var' => 'boolVal',
      'type' => \TType::STRUCT,
      'class' => \thrift\op\BoolPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'mapMap' => -32,
    'listMap' => -31,
    'optMapVal' => -30,
    'optSetVal' => -29,
    'optListVal' => -28,
    'optLateStructVal' => -27,
    'optStructVal' => -26,
    'optEnumVal' => -25,
    'optBinaryVal' => -24,
    'optStringVal' => -23,
    'optDoubleVal' => -22,
    'optFloatVal' => -21,
    'optI64Val' => -20,
    'optI32Val' => -19,
    'optI16Val' => -18,
    'optByteVal' => -17,
    'optBoolVal' => -16,
    'timeVal' => -15,
    'durationVal' => -14,
    'lateStructVal' => -13,
    'unionVal' => -12,
    'structVal' => -11,
    'enumVal' => -10,
    'binaryVal' => -9,
    'stringVal' => -8,
    'doubleVal' => -7,
    'floatVal' => -6,
    'i64Val' => -5,
    'i32Val' => -4,
    'i16Val' => -3,
    'byteVal' => -2,
    'boolVal' => -1,
  ];

  const type TConstructorShape = shape(
    ?'mapMap' => ?\fixtures\patch\MyStructField32Patch,
    ?'listMap' => ?\fixtures\patch\MyStructField31Patch,
    ?'optMapVal' => ?\fixtures\patch\MyStructField30Patch,
    ?'optSetVal' => ?\fixtures\patch\MyStructField29Patch,
    ?'optListVal' => ?\fixtures\patch\MyStructField28Patch,
    ?'optLateStructVal' => ?\fixtures\patch\LateDefStructPatch,
    ?'optStructVal' => ?\fixtures\patch\MyDataPatch,
    ?'optEnumVal' => ?\fixtures\patch\MyStructField25Patch,
    ?'optBinaryVal' => ?\thrift\op\BinaryPatch,
    ?'optStringVal' => ?\thrift\op\StringPatch,
    ?'optDoubleVal' => ?\thrift\op\DoublePatch,
    ?'optFloatVal' => ?\thrift\op\FloatPatch,
    ?'optI64Val' => ?\thrift\op\I64Patch,
    ?'optI32Val' => ?\thrift\op\I32Patch,
    ?'optI16Val' => ?\thrift\op\I16Patch,
    ?'optByteVal' => ?\thrift\op\BytePatch,
    ?'optBoolVal' => ?\thrift\op\BoolPatch,
    ?'timeVal' => ?\thrift\op\TimePatch,
    ?'durationVal' => ?\thrift\op\DurationPatch,
    ?'lateStructVal' => ?\fixtures\patch\LateDefStructPatch,
    ?'unionVal' => ?\fixtures\patch\MyUnionPatch,
    ?'structVal' => ?\fixtures\patch\MyDataPatch,
    ?'enumVal' => ?\fixtures\patch\MyStructField10Patch,
    ?'binaryVal' => ?\thrift\op\BinaryPatch,
    ?'stringVal' => ?\thrift\op\StringPatch,
    ?'doubleVal' => ?\thrift\op\DoublePatch,
    ?'floatVal' => ?\thrift\op\FloatPatch,
    ?'i64Val' => ?\thrift\op\I64Patch,
    ?'i32Val' => ?\thrift\op\I32Patch,
    ?'i16Val' => ?\thrift\op\I16Patch,
    ?'byteVal' => ?\thrift\op\BytePatch,
    ?'boolVal' => ?\thrift\op\BoolPatch,
  );

  const type TShape = shape(
    ?'mapMap' => ?\fixtures\patch\MyStructField32Patch::TShape,
    ?'listMap' => ?\fixtures\patch\MyStructField31Patch::TShape,
    ?'optMapVal' => ?\fixtures\patch\MyStructField30Patch::TShape,
    ?'optSetVal' => ?\fixtures\patch\MyStructField29Patch::TShape,
    ?'optListVal' => ?\fixtures\patch\MyStructField28Patch::TShape,
    ?'optLateStructVal' => ?\fixtures\patch\LateDefStructPatch::TShape,
    ?'optStructVal' => ?\fixtures\patch\MyDataPatch::TShape,
    ?'optEnumVal' => ?\fixtures\patch\MyStructField25Patch::TShape,
    ?'optBinaryVal' => ?\thrift\op\BinaryPatch::TShape,
    ?'optStringVal' => ?\thrift\op\StringPatch::TShape,
    ?'optDoubleVal' => ?\thrift\op\DoublePatch::TShape,
    ?'optFloatVal' => ?\thrift\op\FloatPatch::TShape,
    ?'optI64Val' => ?\thrift\op\I64Patch::TShape,
    ?'optI32Val' => ?\thrift\op\I32Patch::TShape,
    ?'optI16Val' => ?\thrift\op\I16Patch::TShape,
    ?'optByteVal' => ?\thrift\op\BytePatch::TShape,
    ?'optBoolVal' => ?\thrift\op\BoolPatch::TShape,
    ?'timeVal' => ?\thrift\op\TimePatch::TShape,
    ?'durationVal' => ?\thrift\op\DurationPatch::TShape,
    ?'lateStructVal' => ?\fixtures\patch\LateDefStructPatch::TShape,
    ?'unionVal' => ?\fixtures\patch\MyUnionPatch::TShape,
    ?'structVal' => ?\fixtures\patch\MyDataPatch::TShape,
    ?'enumVal' => ?\fixtures\patch\MyStructField10Patch::TShape,
    ?'binaryVal' => ?\thrift\op\BinaryPatch::TShape,
    ?'stringVal' => ?\thrift\op\StringPatch::TShape,
    ?'doubleVal' => ?\thrift\op\DoublePatch::TShape,
    ?'floatVal' => ?\thrift\op\FloatPatch::TShape,
    ?'i64Val' => ?\thrift\op\I64Patch::TShape,
    ?'i32Val' => ?\thrift\op\I32Patch::TShape,
    ?'i16Val' => ?\thrift\op\I16Patch::TShape,
    ?'byteVal' => ?\thrift\op\BytePatch::TShape,
    ?'boolVal' => ?\thrift\op\BoolPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 4927085445189139898;
  /**
   * Original thrift field:-
   * -32: struct module.MyStructField32Patch mapMap
   */
  public ?\fixtures\patch\MyStructField32Patch $mapMap;
  /**
   * Original thrift field:-
   * -31: struct module.MyStructField31Patch listMap
   */
  public ?\fixtures\patch\MyStructField31Patch $listMap;
  /**
   * Original thrift field:-
   * -30: struct module.MyStructField30Patch optMapVal
   */
  public ?\fixtures\patch\MyStructField30Patch $optMapVal;
  /**
   * Original thrift field:-
   * -29: struct module.MyStructField29Patch optSetVal
   */
  public ?\fixtures\patch\MyStructField29Patch $optSetVal;
  /**
   * Original thrift field:-
   * -28: struct module.MyStructField28Patch optListVal
   */
  public ?\fixtures\patch\MyStructField28Patch $optListVal;
  /**
   * Original thrift field:-
   * -27: struct module.LateDefStructPatch optLateStructVal
   */
  public ?\fixtures\patch\LateDefStructPatch $optLateStructVal;
  /**
   * Original thrift field:-
   * -26: struct module.MyDataPatch optStructVal
   */
  public ?\fixtures\patch\MyDataPatch $optStructVal;
  /**
   * Original thrift field:-
   * -25: struct module.MyStructField25Patch optEnumVal
   */
  public ?\fixtures\patch\MyStructField25Patch $optEnumVal;
  /**
   * Original thrift field:-
   * -24: struct patch.BinaryPatch optBinaryVal
   */
  public ?\thrift\op\BinaryPatch $optBinaryVal;
  /**
   * Original thrift field:-
   * -23: struct patch.StringPatch optStringVal
   */
  public ?\thrift\op\StringPatch $optStringVal;
  /**
   * Original thrift field:-
   * -22: struct patch.DoublePatch optDoubleVal
   */
  public ?\thrift\op\DoublePatch $optDoubleVal;
  /**
   * Original thrift field:-
   * -21: struct patch.FloatPatch optFloatVal
   */
  public ?\thrift\op\FloatPatch $optFloatVal;
  /**
   * Original thrift field:-
   * -20: struct patch.I64Patch optI64Val
   */
  public ?\thrift\op\I64Patch $optI64Val;
  /**
   * Original thrift field:-
   * -19: struct patch.I32Patch optI32Val
   */
  public ?\thrift\op\I32Patch $optI32Val;
  /**
   * Original thrift field:-
   * -18: struct patch.I16Patch optI16Val
   */
  public ?\thrift\op\I16Patch $optI16Val;
  /**
   * Original thrift field:-
   * -17: struct patch.BytePatch optByteVal
   */
  public ?\thrift\op\BytePatch $optByteVal;
  /**
   * Original thrift field:-
   * -16: struct patch.BoolPatch optBoolVal
   */
  public ?\thrift\op\BoolPatch $optBoolVal;
  /**
   * Original thrift field:-
   * -15: struct patch.TimePatch timeVal
   */
  public ?\thrift\op\TimePatch $timeVal;
  /**
   * Original thrift field:-
   * -14: struct patch.DurationPatch durationVal
   */
  public ?\thrift\op\DurationPatch $durationVal;
  /**
   * Original thrift field:-
   * -13: struct module.LateDefStructPatch lateStructVal
   */
  public ?\fixtures\patch\LateDefStructPatch $lateStructVal;
  /**
   * Original thrift field:-
   * -12: struct module.MyUnionPatch unionVal
   */
  public ?\fixtures\patch\MyUnionPatch $unionVal;
  /**
   * Original thrift field:-
   * -11: struct module.MyDataPatch structVal
   */
  public ?\fixtures\patch\MyDataPatch $structVal;
  /**
   * Original thrift field:-
   * -10: struct module.MyStructField10Patch enumVal
   */
  public ?\fixtures\patch\MyStructField10Patch $enumVal;
  /**
   * Original thrift field:-
   * -9: struct patch.BinaryPatch binaryVal
   */
  public ?\thrift\op\BinaryPatch $binaryVal;
  /**
   * Original thrift field:-
   * -8: struct patch.StringPatch stringVal
   */
  public ?\thrift\op\StringPatch $stringVal;
  /**
   * Original thrift field:-
   * -7: struct patch.DoublePatch doubleVal
   */
  public ?\thrift\op\DoublePatch $doubleVal;
  /**
   * Original thrift field:-
   * -6: struct patch.FloatPatch floatVal
   */
  public ?\thrift\op\FloatPatch $floatVal;
  /**
   * Original thrift field:-
   * -5: struct patch.I64Patch i64Val
   */
  public ?\thrift\op\I64Patch $i64Val;
  /**
   * Original thrift field:-
   * -4: struct patch.I32Patch i32Val
   */
  public ?\thrift\op\I32Patch $i32Val;
  /**
   * Original thrift field:-
   * -3: struct patch.I16Patch i16Val
   */
  public ?\thrift\op\I16Patch $i16Val;
  /**
   * Original thrift field:-
   * -2: struct patch.BytePatch byteVal
   */
  public ?\thrift\op\BytePatch $byteVal;
  /**
   * Original thrift field:-
   * -1: struct patch.BoolPatch boolVal
   */
  public ?\thrift\op\BoolPatch $boolVal;

  public function __construct(?\fixtures\patch\MyStructField32Patch $mapMap = null, ?\fixtures\patch\MyStructField31Patch $listMap = null, ?\fixtures\patch\MyStructField30Patch $optMapVal = null, ?\fixtures\patch\MyStructField29Patch $optSetVal = null, ?\fixtures\patch\MyStructField28Patch $optListVal = null, ?\fixtures\patch\LateDefStructPatch $optLateStructVal = null, ?\fixtures\patch\MyDataPatch $optStructVal = null, ?\fixtures\patch\MyStructField25Patch $optEnumVal = null, ?\thrift\op\BinaryPatch $optBinaryVal = null, ?\thrift\op\StringPatch $optStringVal = null, ?\thrift\op\DoublePatch $optDoubleVal = null, ?\thrift\op\FloatPatch $optFloatVal = null, ?\thrift\op\I64Patch $optI64Val = null, ?\thrift\op\I32Patch $optI32Val = null, ?\thrift\op\I16Patch $optI16Val = null, ?\thrift\op\BytePatch $optByteVal = null, ?\thrift\op\BoolPatch $optBoolVal = null, ?\thrift\op\TimePatch $timeVal = null, ?\thrift\op\DurationPatch $durationVal = null, ?\fixtures\patch\LateDefStructPatch $lateStructVal = null, ?\fixtures\patch\MyUnionPatch $unionVal = null, ?\fixtures\patch\MyDataPatch $structVal = null, ?\fixtures\patch\MyStructField10Patch $enumVal = null, ?\thrift\op\BinaryPatch $binaryVal = null, ?\thrift\op\StringPatch $stringVal = null, ?\thrift\op\DoublePatch $doubleVal = null, ?\thrift\op\FloatPatch $floatVal = null, ?\thrift\op\I64Patch $i64Val = null, ?\thrift\op\I32Patch $i32Val = null, ?\thrift\op\I16Patch $i16Val = null, ?\thrift\op\BytePatch $byteVal = null, ?\thrift\op\BoolPatch $boolVal = null)[] {
    $this->mapMap = $mapMap;
    $this->listMap = $listMap;
    $this->optMapVal = $optMapVal;
    $this->optSetVal = $optSetVal;
    $this->optListVal = $optListVal;
    $this->optLateStructVal = $optLateStructVal;
    $this->optStructVal = $optStructVal;
    $this->optEnumVal = $optEnumVal;
    $this->optBinaryVal = $optBinaryVal;
    $this->optStringVal = $optStringVal;
    $this->optDoubleVal = $optDoubleVal;
    $this->optFloatVal = $optFloatVal;
    $this->optI64Val = $optI64Val;
    $this->optI32Val = $optI32Val;
    $this->optI16Val = $optI16Val;
    $this->optByteVal = $optByteVal;
    $this->optBoolVal = $optBoolVal;
    $this->timeVal = $timeVal;
    $this->durationVal = $durationVal;
    $this->lateStructVal = $lateStructVal;
    $this->unionVal = $unionVal;
    $this->structVal = $structVal;
    $this->enumVal = $enumVal;
    $this->binaryVal = $binaryVal;
    $this->stringVal = $stringVal;
    $this->doubleVal = $doubleVal;
    $this->floatVal = $floatVal;
    $this->i64Val = $i64Val;
    $this->i32Val = $i32Val;
    $this->i16Val = $i16Val;
    $this->byteVal = $byteVal;
    $this->boolVal = $boolVal;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'mapMap'),
      Shapes::idx($shape, 'listMap'),
      Shapes::idx($shape, 'optMapVal'),
      Shapes::idx($shape, 'optSetVal'),
      Shapes::idx($shape, 'optListVal'),
      Shapes::idx($shape, 'optLateStructVal'),
      Shapes::idx($shape, 'optStructVal'),
      Shapes::idx($shape, 'optEnumVal'),
      Shapes::idx($shape, 'optBinaryVal'),
      Shapes::idx($shape, 'optStringVal'),
      Shapes::idx($shape, 'optDoubleVal'),
      Shapes::idx($shape, 'optFloatVal'),
      Shapes::idx($shape, 'optI64Val'),
      Shapes::idx($shape, 'optI32Val'),
      Shapes::idx($shape, 'optI16Val'),
      Shapes::idx($shape, 'optByteVal'),
      Shapes::idx($shape, 'optBoolVal'),
      Shapes::idx($shape, 'timeVal'),
      Shapes::idx($shape, 'durationVal'),
      Shapes::idx($shape, 'lateStructVal'),
      Shapes::idx($shape, 'unionVal'),
      Shapes::idx($shape, 'structVal'),
      Shapes::idx($shape, 'enumVal'),
      Shapes::idx($shape, 'binaryVal'),
      Shapes::idx($shape, 'stringVal'),
      Shapes::idx($shape, 'doubleVal'),
      Shapes::idx($shape, 'floatVal'),
      Shapes::idx($shape, 'i64Val'),
      Shapes::idx($shape, 'i32Val'),
      Shapes::idx($shape, 'i16Val'),
      Shapes::idx($shape, 'byteVal'),
      Shapes::idx($shape, 'boolVal'),
    );
  }

  public function getName()[]: string {
    return 'MyStructFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -32,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField32Patch",
                    )
                  ),
                )
              ),
              "name" => "mapMap",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -31,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField31Patch",
                    )
                  ),
                )
              ),
              "name" => "listMap",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -30,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField30Patch",
                    )
                  ),
                )
              ),
              "name" => "optMapVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -29,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField29Patch",
                    )
                  ),
                )
              ),
              "name" => "optSetVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -28,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField28Patch",
                    )
                  ),
                )
              ),
              "name" => "optListVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -27,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.LateDefStructPatch",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.LateDefStructPatch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "optLateStructVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -26,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyDataPatch",
                    )
                  ),
                )
              ),
              "name" => "optStructVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -25,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField25Patch",
                    )
                  ),
                )
              ),
              "name" => "optEnumVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -24,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BinaryPatch",
                    )
                  ),
                )
              ),
              "name" => "optBinaryVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -23,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.StringPatch",
                    )
                  ),
                )
              ),
              "name" => "optStringVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -22,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.DoublePatch",
                    )
                  ),
                )
              ),
              "name" => "optDoubleVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -21,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.FloatPatch",
                    )
                  ),
                )
              ),
              "name" => "optFloatVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -20,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I64Patch",
                    )
                  ),
                )
              ),
              "name" => "optI64Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -19,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I32Patch",
                    )
                  ),
                )
              ),
              "name" => "optI32Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -18,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I16Patch",
                    )
                  ),
                )
              ),
              "name" => "optI16Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -17,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BytePatch",
                    )
                  ),
                )
              ),
              "name" => "optByteVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -16,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BoolPatch",
                    )
                  ),
                )
              ),
              "name" => "optBoolVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -15,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.TimePatch",
                    )
                  ),
                )
              ),
              "name" => "timeVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -14,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.DurationPatch",
                    )
                  ),
                )
              ),
              "name" => "durationVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -13,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.LateDefStructPatch",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.LateDefStructPatch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "lateStructVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -12,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyUnionPatch",
                    )
                  ),
                )
              ),
              "name" => "unionVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -11,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyDataPatch",
                    )
                  ),
                )
              ),
              "name" => "structVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -10,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructField10Patch",
                    )
                  ),
                )
              ),
              "name" => "enumVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -9,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BinaryPatch",
                    )
                  ),
                )
              ),
              "name" => "binaryVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -8,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.StringPatch",
                    )
                  ),
                )
              ),
              "name" => "stringVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -7,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.DoublePatch",
                    )
                  ),
                )
              ),
              "name" => "doubleVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.FloatPatch",
                    )
                  ),
                )
              ),
              "name" => "floatVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I64Patch",
                    )
                  ),
                )
              ),
              "name" => "i64Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -4,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I32Patch",
                    )
                  ),
                )
              ),
              "name" => "i32Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.I16Patch",
                    )
                  ),
                )
              ),
              "name" => "i16Val",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BytePatch",
                    )
                  ),
                )
              ),
              "name" => "byteVal",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "patch.BoolPatch",
                    )
                  ),
                )
              ),
              "name" => "boolVal",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "MyStructFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'mapMap' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::MapPatchAdapter",
                "underlyingName" => "MyStructField32PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'listMap' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::ListPatchAdapter",
                "underlyingName" => "MyStructField31PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optMapVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::MapPatchAdapter",
                "underlyingName" => "MyStructField30PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optSetVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::SetPatchAdapter",
                "underlyingName" => "MyStructField29PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optListVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::ListPatchAdapter",
                "underlyingName" => "MyStructField28PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optLateStructVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StructPatchAdapter",
                "underlyingName" => "LateDefStructPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optStructVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StructPatchAdapter",
                "underlyingName" => "MyDataPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optEnumVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "MyStructField25PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'optBinaryVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::BinaryPatchAdapter",
                "underlyingName" => "BinaryPatchStruct",
              )
            ),
          ],
        ),
        'optStringVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StringPatchAdapter",
                "underlyingName" => "StringPatchStruct",
              )
            ),
          ],
        ),
        'optDoubleVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "DoublePatchStruct",
              )
            ),
          ],
        ),
        'optFloatVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "FloatPatchStruct",
              )
            ),
          ],
        ),
        'optI64Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I64PatchStruct",
              )
            ),
          ],
        ),
        'optI32Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I32PatchStruct",
              )
            ),
          ],
        ),
        'optI16Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I16PatchStruct",
              )
            ),
          ],
        ),
        'optByteVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "BytePatchStruct",
              )
            ),
          ],
        ),
        'optBoolVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::BoolPatchAdapter",
                "underlyingName" => "BoolPatchStruct",
              )
            ),
          ],
        ),
        'timeVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "TimeStructPatch",
              )
            ),
          ],
        ),
        'durationVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "DurationStructPatch",
              )
            ),
          ],
        ),
        'lateStructVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StructPatchAdapter",
                "underlyingName" => "LateDefStructPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'unionVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::UnionPatchAdapter",
                "underlyingName" => "MyUnionPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'structVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StructPatchAdapter",
                "underlyingName" => "MyDataPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'enumVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "MyStructField10PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'binaryVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::BinaryPatchAdapter",
                "underlyingName" => "BinaryPatchStruct",
              )
            ),
          ],
        ),
        'stringVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StringPatchAdapter",
                "underlyingName" => "StringPatchStruct",
              )
            ),
          ],
        ),
        'doubleVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "DoublePatchStruct",
              )
            ),
          ],
        ),
        'floatVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "FloatPatchStruct",
              )
            ),
          ],
        ),
        'i64Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I64PatchStruct",
              )
            ),
          ],
        ),
        'i32Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I32PatchStruct",
              )
            ),
          ],
        ),
        'i16Val' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "I16PatchStruct",
              )
            ),
          ],
        ),
        'byteVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::NumberPatchAdapter",
                "underlyingName" => "BytePatchStruct",
              )
            ),
          ],
        ),
        'boolVal' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::BoolPatchAdapter",
                "underlyingName" => "BoolPatchStruct",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'mapMap') === null ? null : (\fixtures\patch\MyStructField32Patch::__fromShape($shape['mapMap'])),
      Shapes::idx($shape, 'listMap') === null ? null : (\fixtures\patch\MyStructField31Patch::__fromShape($shape['listMap'])),
      Shapes::idx($shape, 'optMapVal') === null ? null : (\fixtures\patch\MyStructField30Patch::__fromShape($shape['optMapVal'])),
      Shapes::idx($shape, 'optSetVal') === null ? null : (\fixtures\patch\MyStructField29Patch::__fromShape($shape['optSetVal'])),
      Shapes::idx($shape, 'optListVal') === null ? null : (\fixtures\patch\MyStructField28Patch::__fromShape($shape['optListVal'])),
      Shapes::idx($shape, 'optLateStructVal') === null ? null : (\fixtures\patch\LateDefStructPatch::__fromShape($shape['optLateStructVal'])),
      Shapes::idx($shape, 'optStructVal') === null ? null : (\fixtures\patch\MyDataPatch::__fromShape($shape['optStructVal'])),
      Shapes::idx($shape, 'optEnumVal') === null ? null : (\fixtures\patch\MyStructField25Patch::__fromShape($shape['optEnumVal'])),
      Shapes::idx($shape, 'optBinaryVal') === null ? null : (\thrift\op\BinaryPatch::__fromShape($shape['optBinaryVal'])),
      Shapes::idx($shape, 'optStringVal') === null ? null : (\thrift\op\StringPatch::__fromShape($shape['optStringVal'])),
      Shapes::idx($shape, 'optDoubleVal') === null ? null : (\thrift\op\DoublePatch::__fromShape($shape['optDoubleVal'])),
      Shapes::idx($shape, 'optFloatVal') === null ? null : (\thrift\op\FloatPatch::__fromShape($shape['optFloatVal'])),
      Shapes::idx($shape, 'optI64Val') === null ? null : (\thrift\op\I64Patch::__fromShape($shape['optI64Val'])),
      Shapes::idx($shape, 'optI32Val') === null ? null : (\thrift\op\I32Patch::__fromShape($shape['optI32Val'])),
      Shapes::idx($shape, 'optI16Val') === null ? null : (\thrift\op\I16Patch::__fromShape($shape['optI16Val'])),
      Shapes::idx($shape, 'optByteVal') === null ? null : (\thrift\op\BytePatch::__fromShape($shape['optByteVal'])),
      Shapes::idx($shape, 'optBoolVal') === null ? null : (\thrift\op\BoolPatch::__fromShape($shape['optBoolVal'])),
      Shapes::idx($shape, 'timeVal') === null ? null : (\thrift\op\TimePatch::__fromShape($shape['timeVal'])),
      Shapes::idx($shape, 'durationVal') === null ? null : (\thrift\op\DurationPatch::__fromShape($shape['durationVal'])),
      Shapes::idx($shape, 'lateStructVal') === null ? null : (\fixtures\patch\LateDefStructPatch::__fromShape($shape['lateStructVal'])),
      Shapes::idx($shape, 'unionVal') === null ? null : (\fixtures\patch\MyUnionPatch::__fromShape($shape['unionVal'])),
      Shapes::idx($shape, 'structVal') === null ? null : (\fixtures\patch\MyDataPatch::__fromShape($shape['structVal'])),
      Shapes::idx($shape, 'enumVal') === null ? null : (\fixtures\patch\MyStructField10Patch::__fromShape($shape['enumVal'])),
      Shapes::idx($shape, 'binaryVal') === null ? null : (\thrift\op\BinaryPatch::__fromShape($shape['binaryVal'])),
      Shapes::idx($shape, 'stringVal') === null ? null : (\thrift\op\StringPatch::__fromShape($shape['stringVal'])),
      Shapes::idx($shape, 'doubleVal') === null ? null : (\thrift\op\DoublePatch::__fromShape($shape['doubleVal'])),
      Shapes::idx($shape, 'floatVal') === null ? null : (\thrift\op\FloatPatch::__fromShape($shape['floatVal'])),
      Shapes::idx($shape, 'i64Val') === null ? null : (\thrift\op\I64Patch::__fromShape($shape['i64Val'])),
      Shapes::idx($shape, 'i32Val') === null ? null : (\thrift\op\I32Patch::__fromShape($shape['i32Val'])),
      Shapes::idx($shape, 'i16Val') === null ? null : (\thrift\op\I16Patch::__fromShape($shape['i16Val'])),
      Shapes::idx($shape, 'byteVal') === null ? null : (\thrift\op\BytePatch::__fromShape($shape['byteVal'])),
      Shapes::idx($shape, 'boolVal') === null ? null : (\thrift\op\BoolPatch::__fromShape($shape['boolVal'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'mapMap' => $this->mapMap?->__toShape(),
      'listMap' => $this->listMap?->__toShape(),
      'optMapVal' => $this->optMapVal?->__toShape(),
      'optSetVal' => $this->optSetVal?->__toShape(),
      'optListVal' => $this->optListVal?->__toShape(),
      'optLateStructVal' => $this->optLateStructVal?->__toShape(),
      'optStructVal' => $this->optStructVal?->__toShape(),
      'optEnumVal' => $this->optEnumVal?->__toShape(),
      'optBinaryVal' => $this->optBinaryVal?->__toShape(),
      'optStringVal' => $this->optStringVal?->__toShape(),
      'optDoubleVal' => $this->optDoubleVal?->__toShape(),
      'optFloatVal' => $this->optFloatVal?->__toShape(),
      'optI64Val' => $this->optI64Val?->__toShape(),
      'optI32Val' => $this->optI32Val?->__toShape(),
      'optI16Val' => $this->optI16Val?->__toShape(),
      'optByteVal' => $this->optByteVal?->__toShape(),
      'optBoolVal' => $this->optBoolVal?->__toShape(),
      'timeVal' => $this->timeVal?->__toShape(),
      'durationVal' => $this->durationVal?->__toShape(),
      'lateStructVal' => $this->lateStructVal?->__toShape(),
      'unionVal' => $this->unionVal?->__toShape(),
      'structVal' => $this->structVal?->__toShape(),
      'enumVal' => $this->enumVal?->__toShape(),
      'binaryVal' => $this->binaryVal?->__toShape(),
      'stringVal' => $this->stringVal?->__toShape(),
      'doubleVal' => $this->doubleVal?->__toShape(),
      'floatVal' => $this->floatVal?->__toShape(),
      'i64Val' => $this->i64Val?->__toShape(),
      'i32Val' => $this->i32Val?->__toShape(),
      'i16Val' => $this->i16Val?->__toShape(),
      'byteVal' => $this->byteVal?->__toShape(),
      'boolVal' => $this->boolVal?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'mapMap') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField32Patch>($parsed['mapMap']));
      $_tmp1 = \fixtures\patch\MyStructField32Patch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->mapMap = $_tmp1;
    }
    if (idx($parsed, 'listMap') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField31Patch>($parsed['listMap']));
      $_tmp3 = \fixtures\patch\MyStructField31Patch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->listMap = $_tmp3;
    }
    if (idx($parsed, 'optMapVal') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField30Patch>($parsed['optMapVal']));
      $_tmp5 = \fixtures\patch\MyStructField30Patch::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->optMapVal = $_tmp5;
    }
    if (idx($parsed, 'optSetVal') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField29Patch>($parsed['optSetVal']));
      $_tmp7 = \fixtures\patch\MyStructField29Patch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->optSetVal = $_tmp7;
    }
    if (idx($parsed, 'optListVal') !== null) {
      $_tmp8 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField28Patch>($parsed['optListVal']));
      $_tmp9 = \fixtures\patch\MyStructField28Patch::withDefaultValues();
      $_tmp9->readFromJson($_tmp8);
      $this->optListVal = $_tmp9;
    }
    if (idx($parsed, 'optLateStructVal') !== null) {
      $_tmp10 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStructPatch>($parsed['optLateStructVal']));
      $_tmp11 = \fixtures\patch\LateDefStructPatch::withDefaultValues();
      $_tmp11->readFromJson($_tmp10);
      $this->optLateStructVal = $_tmp11;
    }
    if (idx($parsed, 'optStructVal') !== null) {
      $_tmp12 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyDataPatch>($parsed['optStructVal']));
      $_tmp13 = \fixtures\patch\MyDataPatch::withDefaultValues();
      $_tmp13->readFromJson($_tmp12);
      $this->optStructVal = $_tmp13;
    }
    if (idx($parsed, 'optEnumVal') !== null) {
      $_tmp14 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField25Patch>($parsed['optEnumVal']));
      $_tmp15 = \fixtures\patch\MyStructField25Patch::withDefaultValues();
      $_tmp15->readFromJson($_tmp14);
      $this->optEnumVal = $_tmp15;
    }
    if (idx($parsed, 'optBinaryVal') !== null) {
      $_tmp16 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BinaryPatch>($parsed['optBinaryVal']));
      $_tmp17 = \thrift\op\BinaryPatch::withDefaultValues();
      $_tmp17->readFromJson($_tmp16);
      $this->optBinaryVal = $_tmp17;
    }
    if (idx($parsed, 'optStringVal') !== null) {
      $_tmp18 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\StringPatch>($parsed['optStringVal']));
      $_tmp19 = \thrift\op\StringPatch::withDefaultValues();
      $_tmp19->readFromJson($_tmp18);
      $this->optStringVal = $_tmp19;
    }
    if (idx($parsed, 'optDoubleVal') !== null) {
      $_tmp20 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\DoublePatch>($parsed['optDoubleVal']));
      $_tmp21 = \thrift\op\DoublePatch::withDefaultValues();
      $_tmp21->readFromJson($_tmp20);
      $this->optDoubleVal = $_tmp21;
    }
    if (idx($parsed, 'optFloatVal') !== null) {
      $_tmp22 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\FloatPatch>($parsed['optFloatVal']));
      $_tmp23 = \thrift\op\FloatPatch::withDefaultValues();
      $_tmp23->readFromJson($_tmp22);
      $this->optFloatVal = $_tmp23;
    }
    if (idx($parsed, 'optI64Val') !== null) {
      $_tmp24 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I64Patch>($parsed['optI64Val']));
      $_tmp25 = \thrift\op\I64Patch::withDefaultValues();
      $_tmp25->readFromJson($_tmp24);
      $this->optI64Val = $_tmp25;
    }
    if (idx($parsed, 'optI32Val') !== null) {
      $_tmp26 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I32Patch>($parsed['optI32Val']));
      $_tmp27 = \thrift\op\I32Patch::withDefaultValues();
      $_tmp27->readFromJson($_tmp26);
      $this->optI32Val = $_tmp27;
    }
    if (idx($parsed, 'optI16Val') !== null) {
      $_tmp28 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I16Patch>($parsed['optI16Val']));
      $_tmp29 = \thrift\op\I16Patch::withDefaultValues();
      $_tmp29->readFromJson($_tmp28);
      $this->optI16Val = $_tmp29;
    }
    if (idx($parsed, 'optByteVal') !== null) {
      $_tmp30 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BytePatch>($parsed['optByteVal']));
      $_tmp31 = \thrift\op\BytePatch::withDefaultValues();
      $_tmp31->readFromJson($_tmp30);
      $this->optByteVal = $_tmp31;
    }
    if (idx($parsed, 'optBoolVal') !== null) {
      $_tmp32 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BoolPatch>($parsed['optBoolVal']));
      $_tmp33 = \thrift\op\BoolPatch::withDefaultValues();
      $_tmp33->readFromJson($_tmp32);
      $this->optBoolVal = $_tmp33;
    }
    if (idx($parsed, 'timeVal') !== null) {
      $_tmp34 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\TimePatch>($parsed['timeVal']));
      $_tmp35 = \thrift\op\TimePatch::withDefaultValues();
      $_tmp35->readFromJson($_tmp34);
      $this->timeVal = $_tmp35;
    }
    if (idx($parsed, 'durationVal') !== null) {
      $_tmp36 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\DurationPatch>($parsed['durationVal']));
      $_tmp37 = \thrift\op\DurationPatch::withDefaultValues();
      $_tmp37->readFromJson($_tmp36);
      $this->durationVal = $_tmp37;
    }
    if (idx($parsed, 'lateStructVal') !== null) {
      $_tmp38 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStructPatch>($parsed['lateStructVal']));
      $_tmp39 = \fixtures\patch\LateDefStructPatch::withDefaultValues();
      $_tmp39->readFromJson($_tmp38);
      $this->lateStructVal = $_tmp39;
    }
    if (idx($parsed, 'unionVal') !== null) {
      $_tmp40 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyUnionPatch>($parsed['unionVal']));
      $_tmp41 = \fixtures\patch\MyUnionPatch::withDefaultValues();
      $_tmp41->readFromJson($_tmp40);
      $this->unionVal = $_tmp41;
    }
    if (idx($parsed, 'structVal') !== null) {
      $_tmp42 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyDataPatch>($parsed['structVal']));
      $_tmp43 = \fixtures\patch\MyDataPatch::withDefaultValues();
      $_tmp43->readFromJson($_tmp42);
      $this->structVal = $_tmp43;
    }
    if (idx($parsed, 'enumVal') !== null) {
      $_tmp44 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructField10Patch>($parsed['enumVal']));
      $_tmp45 = \fixtures\patch\MyStructField10Patch::withDefaultValues();
      $_tmp45->readFromJson($_tmp44);
      $this->enumVal = $_tmp45;
    }
    if (idx($parsed, 'binaryVal') !== null) {
      $_tmp46 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BinaryPatch>($parsed['binaryVal']));
      $_tmp47 = \thrift\op\BinaryPatch::withDefaultValues();
      $_tmp47->readFromJson($_tmp46);
      $this->binaryVal = $_tmp47;
    }
    if (idx($parsed, 'stringVal') !== null) {
      $_tmp48 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\StringPatch>($parsed['stringVal']));
      $_tmp49 = \thrift\op\StringPatch::withDefaultValues();
      $_tmp49->readFromJson($_tmp48);
      $this->stringVal = $_tmp49;
    }
    if (idx($parsed, 'doubleVal') !== null) {
      $_tmp50 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\DoublePatch>($parsed['doubleVal']));
      $_tmp51 = \thrift\op\DoublePatch::withDefaultValues();
      $_tmp51->readFromJson($_tmp50);
      $this->doubleVal = $_tmp51;
    }
    if (idx($parsed, 'floatVal') !== null) {
      $_tmp52 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\FloatPatch>($parsed['floatVal']));
      $_tmp53 = \thrift\op\FloatPatch::withDefaultValues();
      $_tmp53->readFromJson($_tmp52);
      $this->floatVal = $_tmp53;
    }
    if (idx($parsed, 'i64Val') !== null) {
      $_tmp54 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I64Patch>($parsed['i64Val']));
      $_tmp55 = \thrift\op\I64Patch::withDefaultValues();
      $_tmp55->readFromJson($_tmp54);
      $this->i64Val = $_tmp55;
    }
    if (idx($parsed, 'i32Val') !== null) {
      $_tmp56 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I32Patch>($parsed['i32Val']));
      $_tmp57 = \thrift\op\I32Patch::withDefaultValues();
      $_tmp57->readFromJson($_tmp56);
      $this->i32Val = $_tmp57;
    }
    if (idx($parsed, 'i16Val') !== null) {
      $_tmp58 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\I16Patch>($parsed['i16Val']));
      $_tmp59 = \thrift\op\I16Patch::withDefaultValues();
      $_tmp59->readFromJson($_tmp58);
      $this->i16Val = $_tmp59;
    }
    if (idx($parsed, 'byteVal') !== null) {
      $_tmp60 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BytePatch>($parsed['byteVal']));
      $_tmp61 = \thrift\op\BytePatch::withDefaultValues();
      $_tmp61->readFromJson($_tmp60);
      $this->byteVal = $_tmp61;
    }
    if (idx($parsed, 'boolVal') !== null) {
      $_tmp62 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \thrift\op\BoolPatch>($parsed['boolVal']));
      $_tmp63 = \thrift\op\BoolPatch::withDefaultValues();
      $_tmp63->readFromJson($_tmp62);
      $this->boolVal = $_tmp63;
    }
  }

}

/**
 * Original thrift struct:-
 * MyStructPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/MyStructPatch'))>>
class MyStructPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStruct::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructFieldPatch::class,
    ),
    5 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStruct::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\MyStructFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 5,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\MyStruct,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\MyStructFieldPatch,
    ?'ensure' => ?\fixtures\patch\MyStruct,
    ?'patch' => ?\fixtures\patch\MyStructFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\MyStruct::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\MyStructFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\MyStruct::TShape,
    ?'patch' => ?\fixtures\patch\MyStructFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 6000283475184898380;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.MyStruct assign
   */
  public ?\fixtures\patch\MyStruct $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.MyStructFieldPatch patchPrior
   */
  public ?\fixtures\patch\MyStructFieldPatch $patchPrior;
  /**
   * Initialize fields, using the given defaults. Applies third.
   * 
   * Original thrift field:-
   * 5: struct module.MyStruct ensure
   */
  public ?\fixtures\patch\MyStruct $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.MyStructFieldPatch patch
   */
  public ?\fixtures\patch\MyStructFieldPatch $patch;

  public function __construct(?\fixtures\patch\MyStruct $assign = null, ?bool $clear = null, ?\fixtures\patch\MyStructFieldPatch $patchPrior = null, ?\fixtures\patch\MyStruct $ensure = null, ?\fixtures\patch\MyStructFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'MyStructPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.MyStructPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStruct",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStruct",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.MyStructFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::StructPatchAdapter",
            "underlyingName" => "MyStructPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'assign' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\Testing' => \thrift\annotation\Testing::fromShape(
              shape(
              )
            ),
          ],
        ),
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyStructFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'ensure' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\Testing' => \thrift\annotation\Testing::fromShape(
              shape(
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "MyStructFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\MyStruct::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\MyStructFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\MyStruct::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\MyStructFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStruct>($parsed['assign']));
      $_tmp1 = \fixtures\patch\MyStruct::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\MyStructFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStruct>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\MyStruct::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\MyStructFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\MyStructFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * LateDefStructFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/LateDefStructFieldPatch'))>>
class LateDefStructFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
  ];
  const dict<string, int> FIELDMAP = dict[
  ];

  const type TConstructorShape = shape(
  );

  const type TShape = shape(
    ...
  );
  const int STRUCTURAL_ID = 957977401221134810;

  public function __construct()[] {
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
    );
  }

  public function getName()[]: string {
    return 'LateDefStructFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.LateDefStructFieldPatch",
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "LateDefStructFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

  }

}

/**
 * Original thrift struct:-
 * LateDefStructPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/LateDefStructPatch'))>>
class LateDefStructPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStruct::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStructFieldPatch::class,
    ),
    5 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStruct::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LateDefStructFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 5,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\LateDefStruct,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\LateDefStructFieldPatch,
    ?'ensure' => ?\fixtures\patch\LateDefStruct,
    ?'patch' => ?\fixtures\patch\LateDefStructFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\LateDefStruct::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\LateDefStructFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\LateDefStruct::TShape,
    ?'patch' => ?\fixtures\patch\LateDefStructFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 6907948067616855680;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.LateDefStruct assign
   */
  public ?\fixtures\patch\LateDefStruct $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.LateDefStructFieldPatch patchPrior
   */
  public ?\fixtures\patch\LateDefStructFieldPatch $patchPrior;
  /**
   * Initialize fields, using the given defaults. Applies third.
   * 
   * Original thrift field:-
   * 5: struct module.LateDefStruct ensure
   */
  public ?\fixtures\patch\LateDefStruct $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.LateDefStructFieldPatch patch
   */
  public ?\fixtures\patch\LateDefStructFieldPatch $patch;

  public function __construct(?\fixtures\patch\LateDefStruct $assign = null, ?bool $clear = null, ?\fixtures\patch\LateDefStructFieldPatch $patchPrior = null, ?\fixtures\patch\LateDefStruct $ensure = null, ?\fixtures\patch\LateDefStructFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'LateDefStructPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.LateDefStructPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.LateDefStruct",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.LateDefStructFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.LateDefStruct",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.LateDefStructFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::StructPatchAdapter",
            "underlyingName" => "LateDefStructPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "LateDefStructFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "LateDefStructFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\LateDefStruct::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\LateDefStructFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\LateDefStruct::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\LateDefStructFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStruct>($parsed['assign']));
      $_tmp1 = \fixtures\patch\LateDefStruct::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStructFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\LateDefStructFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStruct>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\LateDefStruct::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LateDefStructFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\LateDefStructFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * RecursiveField1Patch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/RecursiveField1Patch'))>>
class RecursiveField1Patch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::MAP,
      'ktype' => \TType::STRING,
      'vtype' => \TType::STRUCT,
      'key' => shape(
        'type' => \TType::STRING,
      ),
      'val' => shape(
        'type' => \TType::STRUCT,
        'class' => \fixtures\patch\Recursive::class,
      ),
      'format' => 'collection',
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?Map<string, \fixtures\patch\Recursive>,
    ?'clear' => ?bool,
  );

  const type TShape = shape(
    ?'assign' => ?dict<string, \fixtures\patch\Recursive::TShape>,
    'clear' => bool,
    ...
  );
  const int STRUCTURAL_ID = 734925607853642499;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: map<string, struct module.Recursive> assign
   */
  public ?Map<string, \fixtures\patch\Recursive> $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;

  public function __construct(?Map<string, \fixtures\patch\Recursive> $assign = null, ?bool $clear = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
    );
  }

  public function getName()[]: string {
    return 'RecursiveField1Patch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.RecursiveField1Patch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_map" => \tmeta_ThriftMapType::fromShape(
                    shape(
                      "keyType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_STRING_TYPE,
                        )
                      ),
                      "valueType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                            shape(
                              "name" => "module.Recursive",
                              "underlyingType" => \tmeta_ThriftType::fromShape(
                                shape(
                                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                                    shape(
                                      "name" => "module.Recursive",
                                    )
                                  ),
                                )
                              ),
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
            "underlyingName" => "RecursiveField1PatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : ((new Map($shape['assign']))->map(
        $val0 ==> \fixtures\patch\Recursive::__fromShape($val0),
      )),
      $shape['clear'],
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->map(
        ($_val0) ==> $_val0->__toShape(),
      )
        |> $$ === null ? null : dict($$),
      'clear' => $this->clear,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_json3 = HH\FIXME\UNSAFE_CAST<mixed, Map<string, \fixtures\patch\Recursive>>($parsed['assign']);
      $_container4 = Map {};
      foreach($_json3 as $_key1 => $_value2) {
        $_value5 = \fixtures\patch\Recursive::withDefaultValues();
        $_tmp6 = \json_encode($_value2);
        $_tmp7 = \fixtures\patch\Recursive::withDefaultValues();
        $_tmp7->readFromJson($_tmp6);
        $_value5 = $_tmp7;
        $_container4[$_key1] = $_value5;
      }
      $this->assign = $_container4;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
  }

}

/**
 * Original thrift struct:-
 * RecursiveFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/RecursiveFieldPatch'))>>
class RecursiveFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'nodes',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\RecursiveField1Patch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'nodes' => -1,
  ];

  const type TConstructorShape = shape(
    ?'nodes' => ?\fixtures\patch\RecursiveField1Patch,
  );

  const type TShape = shape(
    ?'nodes' => ?\fixtures\patch\RecursiveField1Patch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 1550759368524310852;
  /**
   * Original thrift field:-
   * -1: struct module.RecursiveField1Patch nodes
   */
  public ?\fixtures\patch\RecursiveField1Patch $nodes;

  public function __construct(?\fixtures\patch\RecursiveField1Patch $nodes = null)[] {
    $this->nodes = $nodes;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'nodes'),
    );
  }

  public function getName()[]: string {
    return 'RecursiveFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.RecursiveFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.RecursiveField1Patch",
                    )
                  ),
                )
              ),
              "name" => "nodes",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "RecursiveFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'nodes' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "RecursiveField1PatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'nodes') === null ? null : (\fixtures\patch\RecursiveField1Patch::__fromShape($shape['nodes'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'nodes' => $this->nodes?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'nodes') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\RecursiveField1Patch>($parsed['nodes']));
      $_tmp1 = \fixtures\patch\RecursiveField1Patch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->nodes = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * RecursivePatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/RecursivePatch'))>>
class RecursivePatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Recursive::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\RecursiveFieldPatch::class,
    ),
    5 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Recursive::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\RecursiveFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 5,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\Recursive,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\RecursiveFieldPatch,
    ?'ensure' => ?\fixtures\patch\Recursive,
    ?'patch' => ?\fixtures\patch\RecursiveFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\Recursive::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\RecursiveFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\Recursive::TShape,
    ?'patch' => ?\fixtures\patch\RecursiveFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 2130991928648210432;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.Recursive assign
   */
  public ?\fixtures\patch\Recursive $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.RecursiveFieldPatch patchPrior
   */
  public ?\fixtures\patch\RecursiveFieldPatch $patchPrior;
  /**
   * Initialize fields, using the given defaults. Applies third.
   * 
   * Original thrift field:-
   * 5: struct module.Recursive ensure
   */
  public ?\fixtures\patch\Recursive $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.RecursiveFieldPatch patch
   */
  public ?\fixtures\patch\RecursiveFieldPatch $patch;

  public function __construct(?\fixtures\patch\Recursive $assign = null, ?bool $clear = null, ?\fixtures\patch\RecursiveFieldPatch $patchPrior = null, ?\fixtures\patch\Recursive $ensure = null, ?\fixtures\patch\RecursiveFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'RecursivePatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.RecursivePatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Recursive",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.RecursiveFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Recursive",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.RecursiveFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::StructPatchAdapter",
            "underlyingName" => "RecursivePatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "RecursiveFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "RecursiveFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\Recursive::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\RecursiveFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\Recursive::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\RecursiveFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Recursive>($parsed['assign']));
      $_tmp1 = \fixtures\patch\Recursive::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\RecursiveFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\RecursiveFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Recursive>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\Recursive::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\RecursiveFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\RecursiveFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * BarFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/BarFieldPatch'))>>
class BarFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'loop',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\LoopPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'loop' => -1,
  ];

  const type TConstructorShape = shape(
    ?'loop' => ?\fixtures\patch\LoopPatch,
  );

  const type TShape = shape(
    ?'loop' => ?\fixtures\patch\LoopPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 1773850756587145723;
  /**
   * Original thrift field:-
   * -1: struct module.LoopPatch loop
   */
  public ?\fixtures\patch\LoopPatch $loop;

  public function __construct(?\fixtures\patch\LoopPatch $loop = null)[] {
    $this->loop = $loop;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'loop'),
    );
  }

  public function getName()[]: string {
    return 'BarFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.BarFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_typedef" => \tmeta_ThriftTypedefType::fromShape(
                    shape(
                      "name" => "module.LoopPatch",
                      "underlyingType" => \tmeta_ThriftType::fromShape(
                        shape(
                          "t_struct" => \tmeta_ThriftStructType::fromShape(
                            shape(
                              "name" => "module.LoopPatch",
                            )
                          ),
                        )
                      ),
                    )
                  ),
                )
              ),
              "name" => "loop",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "BarFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'loop' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
                "underlyingName" => "LoopPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'loop') === null ? null : (\fixtures\patch\LoopPatch::__fromShape($shape['loop'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'loop' => $this->loop?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'loop') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\LoopPatch>($parsed['loop']));
      $_tmp1 = \fixtures\patch\LoopPatch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->loop = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * BarPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/BarPatch'))>>
class BarPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Bar::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
    3 => shape(
      'var' => 'patchPrior',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\BarFieldPatch::class,
    ),
    5 => shape(
      'var' => 'ensure',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Bar::class,
    ),
    6 => shape(
      'var' => 'patch',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\BarFieldPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
    'patchPrior' => 3,
    'ensure' => 5,
    'patch' => 6,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\Bar,
    ?'clear' => ?bool,
    ?'patchPrior' => ?\fixtures\patch\BarFieldPatch,
    ?'ensure' => ?\fixtures\patch\Bar,
    ?'patch' => ?\fixtures\patch\BarFieldPatch,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\Bar::TShape,
    'clear' => bool,
    ?'patchPrior' => ?\fixtures\patch\BarFieldPatch::TShape,
    ?'ensure' => ?\fixtures\patch\Bar::TShape,
    ?'patch' => ?\fixtures\patch\BarFieldPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 5180874570176193342;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.Bar assign
   */
  public ?\fixtures\patch\Bar $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;
  /**
   * Patches any previously set values. Applies second.
   * 
   * Original thrift field:-
   * 3: struct module.BarFieldPatch patchPrior
   */
  public ?\fixtures\patch\BarFieldPatch $patchPrior;
  /**
   * Initialize fields, using the given defaults. Applies third.
   * 
   * Original thrift field:-
   * 5: struct module.Bar ensure
   */
  public ?\fixtures\patch\Bar $ensure;
  /**
   * Patches any set value, including newly set values. Applies last.
   * 
   * Original thrift field:-
   * 6: struct module.BarFieldPatch patch
   */
  public ?\fixtures\patch\BarFieldPatch $patch;

  public function __construct(?\fixtures\patch\Bar $assign = null, ?bool $clear = null, ?\fixtures\patch\BarFieldPatch $patchPrior = null, ?\fixtures\patch\Bar $ensure = null, ?\fixtures\patch\BarFieldPatch $patch = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
    $this->patchPrior = $patchPrior;
    $this->ensure = $ensure;
    $this->patch = $patch;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
      Shapes::idx($shape, 'patchPrior'),
      Shapes::idx($shape, 'ensure'),
      Shapes::idx($shape, 'patch'),
    );
  }

  public function getName()[]: string {
    return 'BarPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.BarPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Bar",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 3,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.BarFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patchPrior",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 5,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Bar",
                    )
                  ),
                )
              ),
              "name" => "ensure",
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 6,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.BarFieldPatch",
                    )
                  ),
                )
              ),
              "name" => "patch",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::StructPatchAdapter",
            "underlyingName" => "BarPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'patchPrior' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "BarFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
        'patch' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
                "underlyingName" => "BarFieldPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\Bar::__fromShape($shape['assign'])),
      $shape['clear'],
      Shapes::idx($shape, 'patchPrior') === null ? null : (\fixtures\patch\BarFieldPatch::__fromShape($shape['patchPrior'])),
      Shapes::idx($shape, 'ensure') === null ? null : (\fixtures\patch\Bar::__fromShape($shape['ensure'])),
      Shapes::idx($shape, 'patch') === null ? null : (\fixtures\patch\BarFieldPatch::__fromShape($shape['patch'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
      'patchPrior' => $this->patchPrior?->__toShape(),
      'ensure' => $this->ensure?->__toShape(),
      'patch' => $this->patch?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Bar>($parsed['assign']));
      $_tmp1 = \fixtures\patch\Bar::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
    if (idx($parsed, 'patchPrior') !== null) {
      $_tmp2 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\BarFieldPatch>($parsed['patchPrior']));
      $_tmp3 = \fixtures\patch\BarFieldPatch::withDefaultValues();
      $_tmp3->readFromJson($_tmp2);
      $this->patchPrior = $_tmp3;
    }
    if (idx($parsed, 'ensure') !== null) {
      $_tmp4 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Bar>($parsed['ensure']));
      $_tmp5 = \fixtures\patch\Bar::withDefaultValues();
      $_tmp5->readFromJson($_tmp4);
      $this->ensure = $_tmp5;
    }
    if (idx($parsed, 'patch') !== null) {
      $_tmp6 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\BarFieldPatch>($parsed['patch']));
      $_tmp7 = \fixtures\patch\BarFieldPatch::withDefaultValues();
      $_tmp7->readFromJson($_tmp6);
      $this->patch = $_tmp7;
    }
  }

}

/**
 * Original thrift struct:-
 * LoopFieldPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/LoopFieldPatch'))>>
class LoopFieldPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    -1 => shape(
      'var' => 'bar',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\BarPatch::class,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'bar' => -1,
  ];

  const type TConstructorShape = shape(
    ?'bar' => ?\fixtures\patch\BarPatch,
  );

  const type TShape = shape(
    ?'bar' => ?\fixtures\patch\BarPatch::TShape,
    ...
  );
  const int STRUCTURAL_ID = 5975782493242643972;
  /**
   * Original thrift field:-
   * -1: struct module.BarPatch bar
   */
  public ?\fixtures\patch\BarPatch $bar;

  public function __construct(?\fixtures\patch\BarPatch $bar = null)[] {
    $this->bar = $bar;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'bar'),
    );
  }

  public function getName()[]: string {
    return 'LoopFieldPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.LoopFieldPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => -1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.BarPatch",
                    )
                  ),
                )
              ),
              "name" => "bar",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::FieldPatchAdapter",
            "underlyingName" => "LoopFieldPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'bar' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
              shape(
                "name" => "::apache::thrift::op::detail::StructPatchAdapter",
                "underlyingName" => "BarPatchStruct",
                "extraNamespace" => "",
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'bar') === null ? null : (\fixtures\patch\BarPatch::__fromShape($shape['bar'])),
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'bar' => $this->bar?->__toShape(),
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'bar') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\BarPatch>($parsed['bar']));
      $_tmp1 = \fixtures\patch\BarPatch::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->bar = $_tmp1;
    }
  }

}

/**
 * Original thrift struct:-
 * LoopPatch
 */
<<\ThriftTypeInfo(shape('uri' => 'test.dev/fixtures/patch/LoopPatch'))>>
class LoopPatch implements \IThriftSyncStruct, \IThriftShapishSyncStruct {
  use \ThriftSerializationTrait;

  const dict<int, this::TFieldSpec> SPEC = dict[
    1 => shape(
      'var' => 'assign',
      'type' => \TType::STRUCT,
      'class' => \fixtures\patch\Loop::class,
    ),
    2 => shape(
      'var' => 'clear',
      'type' => \TType::BOOL,
    ),
  ];
  const dict<string, int> FIELDMAP = dict[
    'assign' => 1,
    'clear' => 2,
  ];

  const type TConstructorShape = shape(
    ?'assign' => ?\fixtures\patch\Loop,
    ?'clear' => ?bool,
  );

  const type TShape = shape(
    ?'assign' => ?\fixtures\patch\Loop::TShape,
    'clear' => bool,
    ...
  );
  const int STRUCTURAL_ID = 5599644265081798743;
  /**
   * Assigns a value. If set, all other operations are ignored.
   * 
   * Original thrift field:-
   * 1: struct module.Loop assign
   */
  public ?\fixtures\patch\Loop $assign;
  /**
   * Clears a value. Applies first.
   * 
   * Original thrift field:-
   * 2: bool clear
   */
  public bool $clear;

  public function __construct(?\fixtures\patch\Loop $assign = null, ?bool $clear = null)[] {
    $this->assign = $assign;
    $this->clear = $clear ?? false;
  }

  public static function withDefaultValues()[]: this {
    return new static();
  }

  public static function fromShape(self::TConstructorShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign'),
      Shapes::idx($shape, 'clear'),
    );
  }

  public function getName()[]: string {
    return 'LoopPatch';
  }

  public function clearTerseFields()[write_props]: void {
  }

  public static function getStructMetadata()[]: \tmeta_ThriftStruct {
    return \tmeta_ThriftStruct::fromShape(
      shape(
        "name" => "module.LoopPatch",
        "fields" => vec[
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 1,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_struct" => \tmeta_ThriftStructType::fromShape(
                    shape(
                      "name" => "module.Loop",
                    )
                  ),
                )
              ),
              "name" => "assign",
              "is_optional" => true,
            )
          ),
          \tmeta_ThriftField::fromShape(
            shape(
              "id" => 2,
              "type" => \tmeta_ThriftType::fromShape(
                shape(
                  "t_primitive" => \tmeta_ThriftPrimitiveType::THRIFT_BOOL_TYPE,
                )
              ),
              "name" => "clear",
            )
          ),
        ],
        "is_union" => false,
      )
    );
  }

  public static function getAllStructuredAnnotations()[write_props]: \TStructAnnotations {
    return shape(
      'struct' => dict[
        '\thrift\annotation\cpp\Adapter' => \thrift\annotation\cpp\Adapter::fromShape(
          shape(
            "name" => "::apache::thrift::op::detail::AssignPatchAdapter",
            "underlyingName" => "LoopPatchStruct",
            "extraNamespace" => "",
          )
        ),
      ],
      'fields' => dict[
        'assign' => shape(
          'field' => dict[],
          'type' => dict[
            '\thrift\op\AssignOnlyPatch' => \thrift\op\AssignOnlyPatch::fromShape(
              shape(
              )
            ),
          ],
        ),
      ],
    );
  }

  public static function __fromShape(self::TShape $shape)[]: this {
    return new static(
      Shapes::idx($shape, 'assign') === null ? null : (\fixtures\patch\Loop::__fromShape($shape['assign'])),
      $shape['clear'],
    );
  }

  public function __toShape()[]: self::TShape {
    return shape(
      'assign' => $this->assign?->__toShape(),
      'clear' => $this->clear,
    );
  }
  public function getInstanceKey()[write_props]: string {
    return \TCompactSerializer::serialize($this);
  }

  public function readFromJson(string $jsonText): void {
    $parsed = json_decode($jsonText, true);

    if ($parsed === null || !($parsed is KeyedContainer<_, _>)) {
      throw new \TProtocolException("Cannot parse the given json string.");
    }

    if (idx($parsed, 'assign') !== null) {
      $_tmp0 = \json_encode(HH\FIXME\UNSAFE_CAST<mixed, \fixtures\patch\Loop>($parsed['assign']));
      $_tmp1 = \fixtures\patch\Loop::withDefaultValues();
      $_tmp1->readFromJson($_tmp0);
      $this->assign = $_tmp1;
    }
    if (idx($parsed, 'clear') !== null) {
      $this->clear = HH\FIXME\UNSAFE_CAST<mixed, bool>($parsed['clear']);
    }
  }

}

