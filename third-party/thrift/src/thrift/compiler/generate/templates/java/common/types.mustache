{{!

  Copyright (c) Meta Platforms, Inc. and affiliates.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

}}

{{!
  `type_isAdapterSet` and `field_hasAdapter` are artefacts of mutable properties
  in the corresponding mstch objects, which are *not* shared across instances.
  If they were shared across instances of the mstch object for the AST node, we
  could maintain a shared context across Whisker/mstch keyed by the AST node
  pointer. However, these are instead per mstch object (i.e. transient), and
  mutated in the template.

  This partial isolates that behavior outside the Whisker layer, into the
  non-migrated context. We capture and propagate `field_hasAdapter` recursively,
  as the same `field:hasAdapter?` would be resolved in mstch.
  For `type_isAdapterSet`, we do not propagate it through recursive boxed_type.
  This is because mstch creates new mstch_type instances for `type:typedef_type`
  (equivalent to `.resolved`) and container element types (i.e. `elem_type`,
  `key_type` and `val_type`).
}}
{{#let export partial boxed_type |type type_isAdapterSet field_hasAdapter|}}
  {{#pragma ignore-newlines}}
{{#if (not (string.empty? type.javaType))}}{{type.javaType}}
{{#else if type.hasAdapter?}}{{type.typeClassName}}
  {{! Recurse through every layer of typedef, as each layer could have an adapter }}
{{#else if type.typedef?}}{{#partial boxed_type type=type.resolved type_isAdapterSet=false field_hasAdapter=field_hasAdapter}}
{{#else if type.void?}}Void
{{#else if type.bool?}}Boolean
{{#else if type.byte?}}Byte
{{#else if type.i16?}}Short
{{#else if type.i32?}}Integer
{{#else if type.i64?}}Long
{{#else if type.double?}}Double
{{#else if type.float?}}Float
{{#else if type.list?}}List<{{#partial boxed_type type=type.elem_type type_isAdapterSet=false field_hasAdapter=field_hasAdapter}}>
{{#else if type.set?}}Set<{{#partial boxed_type type=type.elem_type type_isAdapterSet=false field_hasAdapter=field_hasAdapter}}>
{{#else if (or type.structured? type.enum?)}}{{type.program.javaPackage}}.{{type.javaCapitalName}}
  {{#else if (or type.binary? type.isBinaryString?)}}
{{#if (or type_isAdapterSet field_hasAdapter)}}io.netty.buffer.ByteBuf{{#else}}byte[]{{/if}}
  {{#else if type.string?}}
String
  {{#else if type.map?}}
Map<
{{#partial boxed_type type=type.key_type type_isAdapterSet=false field_hasAdapter=field_hasAdapter}}, {{!}}
{{#partial boxed_type type=type.val_type type_isAdapterSet=false field_hasAdapter=field_hasAdapter}}
>
  {{/if (not (string.empty? type.javaType))}}
{{/let partial}}
